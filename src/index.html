<!DOCTYPE html>
<html id="html" lang="en">
  <head id="head">
    <link rel="manifest" id="manifest-placeholder" />
    <link rel="icon" id="icon" href="data:," />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <link id="build_style" rel="stylesheet" href="./style.css" />
    <title id="title">BEExANT MCU Web</title>
    <style>
      #loading {
        text-align: center;
        background-color: #333333;
        position: fixed;
        width: 100vw;
        height: 100vh;
        top: 0%;
        left: 0%;
        overflow: hidden;
        z-index: 99;
        transition: 1s;
      }

      #loading div {
        font-size: 40px;
        color: white;
        position: relative;
        top: 35%;
        left: 0%;
        text-align: center;
      }
    </style>
  </head>

  <body id="body">
    <div id="loading">
      <div>Loading...</div>
    </div>
    <div id="ui_html">
      <div id="container" class="bg-dark w-screen min-h-screen pb-20">
        <!-- MainPage -->
        <div style="padding-top: 30px">
          <!-- SystemStatus -->
          <div>
            <div
              class="text-shadow-md w-screen max-w-3xl h-24 m-auto flex justify-center items-center"
            >
              <div class="m-4 w-40 relative left-6">
                <table
                  id="system_status_1"
                  class="text-white text-xl text-center font-bold self-center table-auto"
                >
                  <tr>
                    <td>&#128246; 訊號</td>
                  </tr>
                  <tr>
                    <td id="RSSI" class="text-lg h-14 w-32">-</td>
                  </tr>
                </table>
              </div>
              <div class="m-4 w-40">
                <table
                  id="system_status_2"
                  class="text-white text-xl text-center font-bold self-center table-auto"
                >
                  <tr>
                    <td>&#8987; 啟動時間</td>
                  </tr>
                  <tr>
                    <td id="LT" class="text-lg h-14 w-32">-</td>
                  </tr>
                </table>
              </div>
            </div>
          </div>

          <!-- MainUI -->
          <div id="main_ui"></div>
        </div>

        <!-- Title & Setting -->
        <div>
          <div id="footer" class="bg-dark w-full h-16 fixed bottom-0">
            <div class="flex h-full justify-center">
              <div
                class="w-9/12 text-dark text-xl font-bold text-center self-center flex justify-center items-center"
                style="color: white"
              >
                <div id="bottom_title">BEExANT MCU Web</div>
              </div>
              <div class="w-3/12 self-center">
                <button id="open-menu" class="btn-setting">&#9881;</button>
              </div>
            </div>
          </div>
        </div>

        <!-- SettingMenu -->
        <div>
          <!-- Mask -->
          <div>
            <div
              class="fixed hidden top-0 w-full h-full bg-black-8 FadeIn"
              id="mask"
            >
              <!-- Name & RSSI -->
              <div
                class="text-shadow-md w-screen max-w-3xl h-24 m-auto mt-8 flex justify-center items-center"
              >
                <div class="m-4 w-40 relative left-6">
                  <table
                    class="text-white text-xl text-center font-bold self-center table-auto"
                  >
                    <tr>
                      <td>&#128241; 裝置名稱</td>
                    </tr>
                    <tr>
                      <td id="device" class="text-lg h-14 w-32">-</td>
                    </tr>
                  </table>
                </div>
                <div class="m-4 w-40">
                  <table
                    class="text-white text-xl text-center font-bold self-center table-auto"
                  >
                    <tr>
                      <td>&#128339; 時間</td>
                    </tr>
                    <tr>
                      <td id="time" class="text-lg h-14 w-32">-</td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <!-- Menu -->
          <div>
            <div
              class="w-full hidden text-center text-3xl font-bold fixed float-center FadeIn"
              id="menu"
            >
              <div
                id="open-sche"
                class="p-7 bg-black-5 text-white font-bold hover:bg-menu-300 active:bg-menu-200 transition-colors cursor-pointer"
              >
                &#128197; 排程設定
              </div>
              <div
                id="open-custom"
                class="p-7 bg-black-5 text-white font-bold hover:bg-menu-300 active:bg-menu-200 transition-colors cursor-pointer"
              >
                &#128221; 自定義設定
              </div>
              <div
                id="open-network"
                class="p-7 bg-black-5 text-white font-bold hover:bg-menu-300 active:bg-menu-200 transition-colors cursor-pointer"
              >
                &#127760; 網路設定
              </div>
              <div
                id="open-system"
                class="p-7 bg-black-5 text-white font-bold hover:bg-menu-300 active:bg-menu-200 transition-colors cursor-pointer"
              >
                &#128295; 系統設定
              </div>
              <div
                id="open-terminal"
                class="p-7 bg-black-5 text-white font-bold hover:bg-menu-300 active:bg-menu-200 transition-colors cursor-pointer"
              >
                &#128187; 終端機
              </div>
            </div>
          </div>
        </div>

        <!-- SettingMask -->
        <div
          id="mask_setting"
          class="bg-dark fixed top-0 w-screen h-screen hidden"
        >
          <div class="bg-menu-200 text-white top-0 w-screen h-24"></div>
        </div>

        <!-- SchedulePage -->
        <div
          id="sche_page"
          class="fixed top-0 w-screen h-screen hidden pb-20 FadeIn"
        >
          <div
            class="text-white text-shadow-md top-0 w-screen h-24 text-3xl font-bold text-center"
          >
            <span class="relative top-7">&#128197; 排程設定</span>
          </div>
          <!-- Show Schedule -->
          <div
            id="sche_list"
            class="h-1/2 overflow-y-auto overscroll-y-auto"
          ></div>

          <div id="sche_btn_group" class="schedule-btn-group">
            <div class="text-center relative top-2">
              <button id="sche_btn_update" class="btn-basic btn-md default">
                更新
              </button>
              <button id="sche_btn_add" class="btn-basic btn-md primary">
                新增
              </button>
            </div>
          </div>

          <!-- Add Schedule -->
          <div class="h-5/6 pb-10 overflow-y-auto overscroll-y-auto">
            <div id="sche_editor" class="h-screen hidden">
              <!-- Edit -->
              <div class="schedule-week-select">
                <table>
                  <tbody>
                    <td>週</td>
                    <td>
                      <label>
                        <input type="checkbox" name="w1" id="sche_add_w1" />
                        <span class="transition-colors">一</span>
                      </label>
                    </td>
                    <td>
                      <label>
                        <input type="checkbox" name="w2" id="sche_add_w2" />
                        <span class="transition-colors">二</span>
                      </label>
                    </td>
                    <td>
                      <label>
                        <input type="checkbox" name="w3" id="sche_add_w3" />
                        <span class="transition-colors">三</span>
                      </label>
                    </td>
                    <td>
                      <label>
                        <input type="checkbox" name="w4" id="sche_add_w4" />
                        <span class="transition-colors">四</span>
                      </label>
                    </td>
                    <td>
                      <label>
                        <input type="checkbox" name="w5" id="sche_add_w5" />
                        <span class="transition-colors">五</span>
                      </label>
                    </td>
                    <td>
                      <label>
                        <input type="checkbox" name="w6" id="sche_add_w6" />
                        <span class="transition-colors">六</span>
                      </label>
                    </td>
                    <td>
                      <label>
                        <input type="checkbox" name="w7" id="sche_add_w7" />
                        <span class="transition-colors">日</span>
                      </label>
                    </td>
                  </tbody>
                </table>
              </div>

              <div
                class="bg-white text-shadow-md shadow-md w-11/12 max-w-3xl h-14 rounded-2xl flex justify-center m-auto mt-3"
              >
                <table
                  class="text-dark text-xl font-bold self-center w-11/12 table-auto text-center"
                >
                  <tbody>
                    <td>時間</td>
                    <td><input type="time" name="" id="sche_add_time" /></td>
                  </tbody>
                </table>
              </div>

              <div
                class="bg-white text-shadow-md shadow-md w-11/12 max-w-3xl h-40 rounded-2xl flex justify-center m-auto mt-3"
              >
                <table
                  class="text-dark text-xl font-bold self-center w-11/12 table-auto text-center border-separate border-spacing-sm"
                >
                  <tbody>
                    <tr>
                      <td id="area_title_1" class="hidden">1區</td>
                      <td id="area_title_2" class="hidden">2區</td>
                      <td id="area_title_3" class="hidden">3區</td>
                      <td id="area_title_4" class="hidden">4區</td>
                    </tr>
                    <tr>
                      <td id="area_input_1" class="hidden">
                        <select
                          id="sche_add_area_1"
                          class="w-12 border-dark border-2 rounded-r-sm ml-l"
                        ></select>
                      </td>
                      <td id="area_input_2" class="hidden">
                        <select
                          id="sche_add_area_2"
                          class="w-12 border-dark border-2 rounded-r-sm ml-l"
                        ></select>
                      </td>
                      <td id="area_input_3" class="hidden">
                        <select
                          id="sche_add_area_3"
                          class="w-12 border-dark border-2 rounded-r-sm ml-l"
                        ></select>
                      </td>
                      <td id="area_input_4" class="hidden">
                        <select
                          id="sche_add_area_4"
                          class="w-12 border-dark border-2 rounded-r-sm ml-l"
                        ></select>
                      </td>
                    </tr>
                    <tr>
                      <td id="area_title_5" class="hidden">5區</td>
                      <td id="area_title_6" class="hidden">6區</td>
                      <td id="area_title_7" class="hidden">7區</td>
                      <td id="area_title_8" class="hidden">8區</td>
                    </tr>
                    <tr>
                      <td id="area_input_5" class="hidden">
                        <select
                          id="sche_add_area_5"
                          class="w-12 border-dark border-2 rounded-r-sm ml-l"
                        ></select>
                      </td>
                      <td id="area_input_6" class="hidden">
                        <select
                          id="sche_add_area_6"
                          class="w-12 border-dark border-2 rounded-r-sm ml-l"
                        ></select>
                      </td>
                      <td id="area_input_7" class="hidden">
                        <select
                          id="sche_add_area_7"
                          class="w-12 border-dark border-2 rounded-r-sm ml-l"
                        ></select>
                      </td>
                      <td id="area_input_8" class="hidden">
                        <select
                          id="sche_add_area_8"
                          class="w-12 border-dark border-2 rounded-r-sm ml-l"
                        ></select>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div class="schedule-btn-group">
                <div class="text-center relative top-2">
                  <button id="sche_btn_cancel" class="btn-basic btn-md danger">
                    取消
                  </button>
                  <button
                    id="sche_btn_confirm"
                    class="btn-basic btn-md primary"
                  >
                    確認
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- CustomPage -->
        <div
          id="custom_page"
          class="fixed top-0 w-screen h-screen hidden FadeIn"
        >
          <div
            class="text-white text-shadow-md top-0 w-screen h-24 text-3xl font-bold text-center"
          >
            <span class="relative top-7">&#128221; 自定義設定</span>
          </div>
          <!-- SettingList -->
          <div
            id="custom_list"
            class="h-2/3 overflow-y-auto overscroll-y-auto"
          ></div>
        </div>
      </div>

      <!--NetworkPage -->
      <div
        id="network_page"
        class="fixed top-0 w-screen h-screen hidden FadeIn"
      >
        <div
          class="text-white text-shadow-md top-0 w-screen h-24 text-3xl font-bold text-center"
        >
          <span class="relative top-7">&#127760; 網路設定</span>
        </div>
        <!-- SettingList -->
        <div class="h-5/6 pb-20 overflow-y-auto overscroll-y-auto">
          <div class="settingBtn">
            <table>
              <td class="settingBtn-title">目前WiFi</td>
              <td id="wifi" class="settingBtn-val">-</td>
            </table>
          </div>
          <div class="settingBtn hidden">
            <table>
              <td class="settingBtn-title">Socket IP</td>
              <td id="socket" class="settingBtn-val">-</td>
            </table>
          </div>
          <div class="h-10 text-center mt-4">
            <span class="relative top-4 text-3xl text-white font-bold">
              WiFI搜尋清單
            </span>
          </div>

          <ul id="wifi-result" class="list"></ul>
          <div class="w-full h-24 mt-10 mb-20">
            <div class="text-center">
              <button
                id="network_btn_reconnect"
                class="btn-basic btn-md warning"
              >
                重新連上
              </button>
              <button id="network_btn_scan" class="btn-basic btn-md primary">
                搜尋
              </button>
              <button
                id="network_btn_set_socket"
                class="btn-basic btn-md success hidden"
              >
                Socket設定
              </button>
              <button
                id="network_btn_get_socket"
                class="btn-basic btn-md default hidden"
              >
                取得Socket
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- SystemPage -->
      <div id="system_page" class="fixed top-0 w-screen h-screen hidden FadeIn">
        <div
          class="text-white text-shadow-md top-0 w-screen h-24 text-3xl font-bold text-center"
        >
          <span class="relative top-7">&#128295; 系統設定</span>
        </div>
        <!-- SettingList -->
        <div id="system_list" class="h-2/3 overflow-y-auto overscroll-y-auto">
          <div id="system_set_device" class="settingBtn">
            <table>
              <td class="settingBtn-title">裝置名稱</td>
              <td id="system_device" class="settingBtn-val">-</td>
            </table>
          </div>
          <div id="system_set_time" class="settingBtn">
            <table>
              <td class="settingBtn-title">系統時間</td>
              <td class="settingBtn-val">點擊設定</td>
            </table>
          </div>
          <div id="system_set_ssid" class="settingBtn">
            <table>
              <td class="settingBtn-title">SSID 設定</td>
              <td class="settingBtn-val">點擊設定</td>
            </table>
          </div>
          <div id="system_set_bps" class="settingBtn">
            <table>
              <td class="settingBtn-title">UART 設定</td>
              <td id="bps" class="settingBtn-val">-</td>
            </table>
          </div>
          <div id="system_set_SSbps" class="settingBtn">
            <table>
              <td class="settingBtn-title">SS bps 設定</td>
              <td id="SSbps" class="settingBtn-val">-</td>
            </table>
          </div>
          <div id="system_reload" class="settingBtn mb-20">
            <table>
              <td class="settingBtn-title">重新整理</td>
              <td class="settingBtn-val">點擊重整</td>
            </table>
          </div>
        </div>
      </div>

      <!-- TerminalPage -->
      <div
        id="terminal_page"
        class="fixed top-0 w-screen h-screen hidden FadeIn"
      >
        <div
          class="text-white text-shadow-md top-0 w-screen h-24 text-3xl font-bold text-center"
        >
          <span class="relative top-7">&#128187; 終端機</span>
        </div>
        <div class="h-2/3 overflow-y-auto overscroll-y-auto">
          <div class="text-center h-2/5 mt-8">
            <textarea
              name=""
              id="tx"
              cols="30"
              rows="10"
              class="bg-black text-terminal shadow-md px-4 py-2 w-11/12 max-w-3xl h-full rounded-xl m-auto border-4 border-gray-300 whitespace-pre"
              disabled
            ></textarea>
          </div>
          <input
            class="appearance-none block w-11/12 max-w-xl bg-gray-200 text-gray-700 border border-gray-200 rounded-lg py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500 mt-10 m-auto"
            id="cmd_input"
            type="text"
            name="float-input"
            placeholder="輸入命令..."
          />
          <div class="w-full h-24 mt-4 mb-20">
            <div class="text-center">
              <button id="terminal_clear" class="btn-basic btn-md warning">
                清除
              </button>
              <button id="terminal_send" class="btn-basic btn-md primary">
                發送
              </button>
              <button id="terminal_scroll" class="btn-basic btn-md success">
                捲動: ON
              </button>
              <button id="terminal_log" class="btn-basic btn-md success">
                Log: ON
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- BottomMenu -->
      <div id="menu_bottom" class="hidden">
        <div class="w-screen flex justify-center m-auto fixed -bottom-8">
          <div class="buttomMenu-btn">
            <div id="btmMenu_sche">&#128197;</div>
          </div>
          <div id="btmMenu_custom_btn" class="buttomMenu-btn">
            <div id="btmMenu_custom">&#128221;</div>
          </div>
          <div class="buttomMenu-btn">
            <div id="btmMenu_network">&#127760;</div>
          </div>
          <div class="buttomMenu-btn">
            <div id="btmMenu_system">&#128295;</div>
          </div>
          <div class="buttomMenu-btn">
            <div id="btmMenu_terminal">&#128187;</div>
          </div>
          <div id="btmMenu_close" class="w-1/4 ml-2 transform -translate-y-4">
            <button
              class="bg-danger text-white text-3xl font-bold w-full h-4/5 rounded-t-xl hover:bg-red-500 active:bg-red-400"
            >
              &#9747;
            </button>
          </div>
        </div>
      </div>

      <!-- Spin Animation -->
      <div
        id="spin"
        class="bg-black-5 fixed w-screen h-screen top-0 flex justify-center items-center hidden"
      >
        <div class="ml-4">
          <svg
            id="LOGO"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 205.67 296.82"
            class="w-24 mr-2"
          >
            <title>BEExANT_SVG</title>
            <g id="Group" stroke="#FFFFFF" stroke-width="3" fill="#ffffff">
              <path
                class="path"
                d="M151.54,137.47a3.45,3.45,0,1,1-3.45-3.44A3.46,3.46,0,0,1,151.54,137.47Z"
                transform="translate(-85.87 -50.81)"
              />
              <path
                class="path"
                d="M151.54,147.14a3.45,3.45,0,1,1-3.45-3.45A3.45,3.45,0,0,1,151.54,147.14Z"
                transform="translate(-85.87 -50.81)"
              />
              <path
                class="path"
                d="M289.76,245.23,212.59,152a4.43,4.43,0,0,0,.26-1.45v-16.2a4.44,4.44,0,0,0-2.19-3.78l-14.91-9.06,10.89-14c.06-.07.09-.16.15-.24a4.31,4.31,0,0,0-.35-5.55L191.16,85.48a5,5,0,0,0-6.72-.37,4.33,4.33,0,0,0-.39,6.35L196.78,105l-10.42,13.44h-8.07V82.56l27-24.89a3.85,3.85,0,0,0,.08-5.66,4.42,4.42,0,0,0-6-.07L171.64,77.52a3.93,3.93,0,0,0-.51.58,3.85,3.85,0,0,0-1.3,2.87v37.45H167.6a4.2,4.2,0,0,0-.62.06,4.34,4.34,0,0,0-.63-.06h-1.9V83a4,4,0,0,0-2.06-3.42c-.09-.06-.17-.14-.27-.2l-12.54-7.6,11.47-11.16a3.84,3.84,0,0,0-.08-5.65,4.41,4.41,0,0,0-6,.08L140.7,68.91c-.11.11-.2.24-.3.36a4.15,4.15,0,0,0-1.05,1,3.88,3.88,0,0,0,1.28,5.53L156,85.14v33.28h-9L136.58,105l12.73-13.52a4.32,4.32,0,0,0-.39-6.35,5,5,0,0,0-6.72.37L126.93,101.7a4.29,4.29,0,0,0-.35,5.55,1.94,1.94,0,0,0,.15.24l11.08,14.28-14.52,8.82a4.44,4.44,0,0,0-2.19,3.78v16.2a4.47,4.47,0,0,0,2.19,3.79L137,162.68l-50.5,75.09c0,.06-.06.13-.1.19s-.14.25-.2.38-.1.24-.14.36-.08.24-.11.37,0,.26-.06.39a2.31,2.31,0,0,0,0,.37c0,.13,0,.26,0,.39s0,.26.05.38L86,241c0,.11.08.23.13.35a2.93,2.93,0,0,0,.19.4c0,.06,0,.12.09.19l63.74,103.7a4.29,4.29,0,0,0,3.67,2,4.37,4.37,0,0,0,2.12-.54l.21-.14.2-.14.39-.3c.12-.11.23-.23.34-.35l.15-.18a3.82,3.82,0,0,0,.86-2.39V220a4,4,0,0,0-4.09-5h-16.3a8.54,8.54,0,0,0-7.32-4,8,8,0,1,0,0,16,8.56,8.56,0,0,0,7.32-4h11.93v30.16H137.72a8.54,8.54,0,0,0-7.32-4,8,8,0,1,0,0,16,8.54,8.54,0,0,0,7.32-4h11.93v67.7L95,240l49.42-73.5.27,0h18.75V271.47a4,4,0,0,0,.1.85,4.13,4.13,0,0,0,4.19,3.62h23.48a8.54,8.54,0,0,0,7.32,4,8,8,0,1,0,0-16,8.54,8.54,0,0,0-7.32,4H172v-31.3h13a8.54,8.54,0,0,0,7.32,4,8,8,0,1,0,0-16,8.54,8.54,0,0,0-7.32,4H172V199.16a4.24,4.24,0,0,0,.88.09h6.43a8.54,8.54,0,0,0,7.32,4,8,8,0,1,0,0-16,8.54,8.54,0,0,0-7.32,4h-6.43a4.24,4.24,0,0,0-.88.09V166.53h17.27a4.94,4.94,0,0,0,2.58-.72l5.58-3.39L224,277.32a4.51,4.51,0,0,0-1.33.63l-51.18,36.67c-.08.05-.13.12-.2.17a2.28,2.28,0,0,0-.33.29,2.55,2.55,0,0,0-.26.3l-.24.31c-.07.11-.13.23-.19.34s-.12.23-.17.35a2.78,2.78,0,0,0-.12.38c0,.12-.07.24-.1.37s0,.28,0,.43a2,2,0,0,0,0,.24v25.67a4.24,4.24,0,0,0,8.46,0V319.79l49.51-35.46a4,4,0,0,0,.75-.72l49.36,12.72a4.35,4.35,0,0,0,5-2.25,3.85,3.85,0,0,0,.47-1.25l8.11-43.67A3.89,3.89,0,0,0,289.76,245.23ZM130.25,222.61a3.81,3.81,0,1,1,4-3.81A3.92,3.92,0,0,1,130.25,222.61Zm0,38.11a3.81,3.81,0,1,1,4-3.8A3.91,3.91,0,0,1,130.25,260.72ZM198.89,268a3.81,3.81,0,1,1-4,3.8A3.92,3.92,0,0,1,198.89,268Zm-6.64-39.17a3.81,3.81,0,1,1-4,3.81A3.93,3.93,0,0,1,192.25,228.83Zm-5.58-37.39a3.81,3.81,0,1,1-4,3.81A3.92,3.92,0,0,1,186.67,191.44Zm16.66-43.33-15.5,9.42H167.6a4.2,4.2,0,0,0-.62.06,4.34,4.34,0,0,0-.63-.06H146.13l-15.51-9.42V136.83l15.51-9.41h20.22c.22,0,.42,0,.63-.06a6.2,6.2,0,0,0,.62.06h20.23l15.5,9.41Zm72.43,139.38-43.31-11.17L205,157.81l1.11-.67,76.69,92.63Z"
                transform="translate(-85.87 -50.81)"
              />
              <path
                class="path"
                d="M228.58,343.77l-2.26,3.85a59.9,59.9,0,0,1-7.11-5.09,16.08,16.08,0,0,1-11.83,5q-7.37,0-10.7-4.47a10.09,10.09,0,0,1-1.85-6.07q0-5.14,5.6-9.32c.76-.55,1.63-1.13,2.63-1.75q-3.3-4.79-3.3-9c0-3.57,1.31-6.2,3.91-7.88a9.77,9.77,0,0,1,5.25-1.44q5.06,0,7.21,3.6a8.27,8.27,0,0,1,1.13,4.28q0,4.83-5.35,8.95c-.86.65-1.92,1.39-3.19,2.21A100.55,100.55,0,0,0,219,336.51a24.19,24.19,0,0,0,4.27-10.34h4.42A34.71,34.71,0,0,1,222,339.08,54.56,54.56,0,0,0,228.58,343.77Zm-29.33-6.95a6.21,6.21,0,0,0,4,6.07,11.3,11.3,0,0,0,4.53.88q4.38-.06,8.34-4a106.17,106.17,0,0,1-10.91-10.9c-3.09,2.05-5,4-5.61,5.86A6.21,6.21,0,0,0,199.25,336.82Zm4.53-20.12c0,2.06,1,4.44,2.83,7.15q4.72-2.93,6-5.3a6.17,6.17,0,0,0,.77-2.93,4.31,4.31,0,0,0-2.21-4.07A4.59,4.59,0,0,0,209,311a4.64,4.64,0,0,0-4.79,3.09A7,7,0,0,0,203.78,316.7Z"
                transform="translate(-85.87 -50.81)"
              />
              <g stroke="#FFFFFF" stroke-width="2" fill="#ffffff">
                <path
                  class="path"
                  d="M223.6,319.16V295.83h7.73q8.4.06,8.44,5.75a5.44,5.44,0,0,1-1.67,4.1,4.45,4.45,0,0,1-1.51.92v.19a5.16,5.16,0,0,1,4.13,3.66,6.89,6.89,0,0,1,.25,1.85,6,6,0,0,1-4.19,6,12.79,12.79,0,0,1-4.83.83Zm4.68-13.85H231c2.69-.19,4.11-1.2,4.25-3.05,0-1.54-.86-2.45-2.59-2.74a9.57,9.57,0,0,0-1.6-.12h-2.77Zm0,10.25h3.24q4.89,0,4.92-3.54-.06-3.19-4.92-3.23h-3.24Z"
                  transform="translate(-85.87 -50.81)"
                />
                <path
                  class="path"
                  d="M252.36,319.59a8.28,8.28,0,0,1-6.62-2.86,9.45,9.45,0,0,1-2.16-6.37,9.36,9.36,0,0,1,3-7.24,7.69,7.69,0,0,1,5.26-2.06,6.58,6.58,0,0,1,6.31,3.6,10.38,10.38,0,0,1,1.08,4.87,7.83,7.83,0,0,1-.21,2.09h-10.9a4.56,4.56,0,0,0,3.08,4.16,5.82,5.82,0,0,0,1.81.27,7.72,7.72,0,0,0,4-1.23l1.56,2.83A10.51,10.51,0,0,1,252.36,319.59Zm-4.34-11h7.2q0-3.42-2.65-3.85a4,4,0,0,0-.7-.06,3.54,3.54,0,0,0-3.24,1.94A5.76,5.76,0,0,0,248,308.57Z"
                  transform="translate(-85.87 -50.81)"
                />
                <path
                  class="path"
                  d="M270.64,319.59a8.26,8.26,0,0,1-6.61-2.86,9.45,9.45,0,0,1-2.16-6.37,9.36,9.36,0,0,1,3-7.24,7.69,7.69,0,0,1,5.26-2.06,6.58,6.58,0,0,1,6.31,3.6,10.38,10.38,0,0,1,1.08,4.87,7.36,7.36,0,0,1-.22,2.09H266.37a4.56,4.56,0,0,0,3.07,4.16,5.89,5.89,0,0,0,1.82.27,7.66,7.66,0,0,0,4-1.23l1.57,2.83A10.54,10.54,0,0,1,270.64,319.59Zm-4.34-11h7.21q0-3.42-2.65-3.85a4.08,4.08,0,0,0-.71-.06,3.53,3.53,0,0,0-3.23,1.94A6,6,0,0,0,266.3,308.57Z"
                  transform="translate(-85.87 -50.81)"
                />
              </g>
              <g stroke="#FFFFFF" stroke-width="2" fill="#ffffff">
                <path
                  class="path"
                  d="M251.83,347.19l-1.63-6h-7.57l-1.63,6h-4.74l7.48-23.33h5.48l7.48,23.33Zm-8.19-9.6h5.54l-.7-2.56c-.06-.2-.63-2.33-1.7-6.37q-.18-.71-.33-1.26h-.13q-.82,3.57-2,7.63Z"
                  transform="translate(-85.87 -50.81)"
                />
                <path
                  class="path"
                  d="M259.07,347.19V329.55h3.78l.31,2.31h.12a8.57,8.57,0,0,1,5.73-2.77q5.44.06,5.48,7.11v11h-4.65V336.76c0-2-.51-3.22-1.54-3.57a3.16,3.16,0,0,0-.95-.13,4.61,4.61,0,0,0-3,1.39l-.68.61v12.13Z"
                  transform="translate(-85.87 -50.81)"
                />
                <path
                  class="path"
                  d="M285.73,347.62q-5.79-.06-5.82-6.61v-7.82h-2.46v-3.42l2.71-.22.52-4.74h3.88v4.74h4.34v3.64h-4.34V341c0,2,.84,3,2.4,3a4.59,4.59,0,0,0,1.72-.4l.77,3.39A12.32,12.32,0,0,1,285.73,347.62Z"
                  transform="translate(-85.87 -50.81)"
                />
              </g>
            </g>
          </svg>
        </div>
      </div>
    </div>
    <div
      id="version"
      class="text-white"
      style="position: fixed; left: 0px; bottom: 0px; font-size: 12px"
    ></div>
    <div id="build_check" style="display: none">dev</div>

    <div id="webeditor">
      <div id="webeditor_drag">
        <div id="webeditor_top" class="w-1/12 font-bold cursor-pointer">
          &#9737;
        </div>
        <div class="w-10/12 text-xl font-bold">BEExANT 網頁編輯器</div>
        <div id="webeditor_scale" class="w-1/12 font-bold cursor-pointer">
          &#8210;
        </div>
      </div>
      <div id="webeditor_container">
        <div>
          <select
            id="file_select"
            class="bg-yellow-200 rounded-lg w-64 h-12 mt-2 border-none"
          ></select>
        </div>
        <div class="flex justify-center">
          <button id="webeditor_ui_btn" class="btn-basic btn-sm primary">
            UI
          </button>
          <button id="webeditor_data_btn" class="btn-basic btn-sm warning">
            DATA
          </button>
          <button id="webeditor_cmd_btn" class="btn-basic btn-sm success">
            CMD
          </button>
          <button id="webeditor_config_btn" class="btn-basic btn-sm default">
            &#9881;
          </button>
          <button id="webeditor_file_btn" class="btn-basic btn-sm default">
            &#128221;
          </button>
        </div>
        <div id="webeditor_ui">
          <div
            class="text-center text-lg w-36 bg-primary text-white rounded-md m-auto mt-2 mb-2"
          >
            主頁區塊HTML
          </div>
          <div>
            <textarea name="" id="tx_ui_html" cols="30" rows="10"></textarea>
          </div>
          <div
            class="text-center text-lg w-36 bg-primary text-white rounded-md m-auto mt-2 mb-2"
          >
            主頁區塊CSS
          </div>
          <div>
            <div>
              <textarea name="" id="tx_ui_css" cols="30" rows="10"></textarea>
            </div>
          </div>
        </div>
        <div id="webeditor_data" class="hidden">
          <div
            class="text-center text-lg w-48 bg-warning text-dark rounded-md m-auto mt-2 mb-2"
          >
            資料處理區塊
          </div>

          <div>
            <textarea name="" id="tx_data" cols="30" rows="10"></textarea>
          </div>
          <div>
            <button id="script_data_run" class="btn-basic btn-sm success">
              Run
            </button>
            <button id="script_data_reset" class="btn-basic btn-sm danger">
              Reset
            </button>
          </div>
        </div>
        <div id="webeditor_cmd" class="hidden">
          <div
            class="text-center text-lg w-56 bg-success text-white rounded-md m-auto mt-2 mb-2"
          >
            自定義按鈕UI區塊
          </div>
          <div>
            <textarea name="" id="tx_ui_app" cols="30" rows="10"></textarea>
          </div>
          <div
            class="text-center text-lg w-56 bg-success text-white rounded-md m-auto mt-2 mb-2"
          >
            自定義按鈕程式區塊
          </div>
          <div>
            <textarea name="" id="tx_app" cols="30" rows="10"></textarea>
          </div>
          <div>
            <button id="script_app_run" class="btn-basic btn-sm success">
              Run
            </button>
            <button id="script_app_reset" class="btn-basic btn-sm danger">
              Reset
            </button>
          </div>
        </div>
        <div id="webeditor_config" class="hidden">
          <div class="inline-block justify-center">
            <div
              class="text-center text-xl w-64 bg-white text-dark rounded-md m-auto mt-2 mb-2"
            >
              編輯器UI屬性
            </div>
            <div>
              <div>透明度</div>
              <div>
                <input
                  type="range"
                  name=""
                  id="webeditor_opacity"
                  min="5"
                  value="100"
                />
              </div>
            </div>
            <div
              class="text-center text-xl w-64 bg-white text-dark rounded-md m-auto mt-2 mb-2"
            >
              網頁功能
            </div>

            <div>
              <div
                class="text-center text-lg w-36 bg-warning text-dark rounded-md m-auto mt-2 mb-2"
              >
                參數設定
              </div>
              <div>
                <label for="option_title">
                  網頁標題
                  <input
                    class="appearance-none block w-11/12 max-w-sm bg-gray-200 text-gray-700 border border-gray-200 rounded-lg py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500 mt-2 mb-2 m-auto"
                    id="option_title"
                    type="text"
                    name="float-input"
                    placeholder="title..."
                    maxlength="50"
                  />
                </label>
                <label for="option_title">
                  網頁版本
                  <input
                    class="appearance-none block w-11/12 max-w-sm bg-gray-200 text-gray-700 border border-gray-200 rounded-lg py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500 mt-2 mb-2 m-auto"
                    id="option_version"
                    type="text"
                    name="float-input"
                    placeholder="title..."
                    maxlength="50"
                  />
                </label>
                <label
                  for="option_home_color"
                  class="flex justify-center items-center mt-2 mb-2"
                  >主頁文字顏色
                  <input type="color" name="" id="option_home_color" />
                </label>
                <label
                  for="option_home_background"
                  class="flex justify-center items-center mt-2 mb-2"
                  >主頁背景顏色
                  <input type="color" name="" id="option_home_background" />
                </label>
              </div>
              <div
                class="text-center text-lg w-36 bg-warning text-dark rounded-md m-auto mt-2 mb-2"
              >
                功能啟用
              </div>
              <div>
                <label>
                  <input type="checkbox" name="" id="option_schedule" checked />
                  <span class="transition-colors m-2">排程設定</span>
                </label>
                <label>
                  <input type="checkbox" name="" id="option_custom" checked />
                  <span class="transition-colors m-2">自訂義設定</span>
                </label>
                <label>
                  <input type="checkbox" name="" id="option_network" checked />
                  <span class="transition-colors m-2">網路設定</span>
                </label>
                <label>
                  <input type="checkbox" name="" id="option_system" checked />
                  <span class="transition-colors m-2">系統設定</span>
                </label>
                <label>
                  <input type="checkbox" name="" id="option_terminal" checked />
                  <span class="transition-colors m-2">終端機</span>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div id="webeditor_file" class="hidden">
          <div class="inline-block justify-center">
            <div
              class="text-center text-xl w-64 bg-white text-dark rounded-md m-auto mt-2 mb-2"
            >
              檔案管理
            </div>
            <div
              class="text-center text-lg w-36 bg-warning text-dark rounded-md m-auto mt-2 mb-2"
            >
              網頁匯出
            </div>
            <div>
              <div>
                <label>
                  <input type="checkbox" name="" id="option_zip" checked />
                  <span class="transition-colors m-2">壓縮檔案?</span>
                </label>
              </div>
              <div>
                <button id="export_web" class="btn-basic btn-md success">
                  匯出
                </button>
              </div>
            </div>
            <div
              class="text-center text-lg w-36 bg-warning text-dark rounded-md m-auto mt-2 mb-2"
            >
              網頁匯入
            </div>
            <div class="flex flex-wrap justify-center">
              <div class="btn-import">
                <label for="import_html">
                  HTML 匯入
                  <input type="file" accept=".html" id="import_html" />
                </label>
              </div>
              <div class="btn-import">
                <label for="import_css">
                  CSS 匯入
                  <input type="file" accept=".css" id="import_css" />
                </label>
              </div>
              <div class="btn-import">
                <label for="import_data">
                  DATA 匯入
                  <input type="file" accept=".js" id="import_data" />
                </label>
              </div>
              <div class="btn-import">
                <label for="import_cmd">
                  CMD 匯入
                  <input type="file" accept=".js" id="import_cmd" />
                </label>
              </div>
            </div>
            <div
              class="text-center text-lg w-36 bg-warning text-dark rounded-md m-auto mt-2 mb-2"
            >
              存檔管理
            </div>
            <div class="flex justify-center flex-wrap items-center">
              <div>
                <a id="export_file"></a>
                <button id="export_file_btn" class="btn-basic btn-md success">
                  匯出
                </button>
              </div>
              <div class="btn-import">
                <label for="import_file">
                  匯入
                  <input type="file" accept=".json" id="import_file" />
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <!-- <script src="./index_load.js"></script> -->
  <script id="dev_webeditor" src="./webeditor.js"></script>
  <script id="dev_index" src="./index.js"></script>
  <script id="dev_app" src="./app.js"></script>
  <script id="script_data"></script>
  <script id="script_app"></script>
  <!-- <script src="./worker.js" type="javascript/worker"></script> -->
  <script id="dev_script">
    // setTimeout("connect()", 3000);

    document.onreadystatechange = loading;

    // 完成Loading
    function loading() {
      if (document.readyState == "complete") {
        setTimeout(() => {
          $("loading").style.display = "none";
        }, 1500);
        console.log("load success");
      }
    }
  </script>
  <script id="index_load">
    window.$ = function (id) {
      return document.getElementById(id);
    };
    // 版本與韌體資源
    window.cacheName = document.getElementById("version").innerText;
    window.sourceState = "";

    // 需要緩存的靜態檔案
    let cacheList = {
      app: "app.js",
      src: "index.js",
      worker: "worker.js",
      style: "style.css",
      ui: "ui.html",
      manifest: "manifest.json",
    };

    window.worker = undefined;

    // worker 程式來源
    window.worker_url = `./${cacheList.worker}`;

    // 用戶端的緩存版本
    window.local_cache_name = localStorage.getItem("local_cache_name");

    // 用戶端的緩存檔案內容
    window.code_html = localStorage.getItem(`${cacheName}_ui.html`);
    window.code_app = localStorage.getItem(`${cacheName}_${cacheList.app}`);
    window.code_src = localStorage.getItem(`${cacheName}_${cacheList.src}`);
    window.code_worker = localStorage.getItem(
      `${cacheName}_${cacheList.worker}`
    );
    window.code_style = localStorage.getItem(`${cacheName}_${cacheList.style}`);
    window.code_manifest = localStorage.getItem(
      `${cacheName}_${cacheList.manifest}`
    );

    // 設定主頁面的hash
    window.location.hash = "#home";
    localStorage.setItem("current_hash", location.hash);

    // 建立worker與websocket連線
    window.connect = function () {
      try {
        console.log("create worker...");
        console.log(window.worker);
        if (typeof Worker === "undefined") {
          console.log("not support Worker");
          return;
        }
        if (typeof window.worker === "undefined") {
          window.worker = new Worker(worker_url);
          console.log(window.worker);
          window.worker.onmessage = wkMsg;
        }
        cmd = { URL: document.URL };
        window.worker.postMessage(cmd);
      } catch (error) {
        console.error(error);
        // alert(error);
        // reloadWeb();
      }
    };

    // 顯示資源載入狀態
    window.sourceLoading = (source) => {
      if (document.getElementById("version")) {
        document.getElementById("version").innerText = `${cacheName}-${source}`;
        console.log(`Load ${source} source.`);
      }
    };

    // 取得檔案並設定緩存與載入
    window.getFileWithImport = (name, type) => {
      sourceLoading(`cached ${name}`);
      fetch(`${window.location.protocol}//${window.location.host}/${name}`)
        .then((res) => {
          res.text().then((data) => {
            // 設定緩存
            localStorage.setItem(`${cacheName}_${name}`, data);
            // 載入檔案
            switch (type) {
              case "html":
                addHTML(data);
                break;
              case "css":
                addStyle(data);
                break;
              case "js":
                addScript(data);
                break;
              case "worker":
                addWorker(data);
                setTimeout(() => {
                  let blob = new Blob([data], { type: "text/javascript" });
                  worker_url = window.URL.createObjectURL(blob);
                  console.log(worker_url);
                }, 300);
                break;
              case "manifest":
                addManifest(data);
                break;
              default:
                console.log("not vaild file type.");
                break;
            }
          });
        })
        .catch((err) => {
          console.error(err);
        });
    };

    // 建立緩存
    function createCache(cacheList) {
      setTimeout(() => getFileWithImport(cacheList.style, "css"), 500);
      setTimeout(() => getFileWithImport(cacheList.ui, "html"), 1000);
      setTimeout(() => getFileWithImport(cacheList.src, "js"), 1500);
      setTimeout(() => getFileWithImport(cacheList.worker, "worker"), 2000);
      setTimeout(() => getFileWithImport(cacheList.app, "js"), 2500);
      setTimeout(() => getFileWithImport(cacheList.manifest, "manifest"), 3000);
      setTimeout(() => connect(), 4000);
      setTimeout(() => sourceLoading("origin-done"), 3500);
    }

    // 使用緩存
    function useCachedData() {
      addHTML(code_html);

      addScript(code_src);
      addStyle(code_style);
      addWorker(code_worker);
      addManifest(code_manifest);
      addIcon(code_manifest);

      setTimeout(() => {
        addScript(code_app);
      }, 500);

      // 建立worker
      setTimeout(() => {
        let blob = new Blob([document.getElementById("worker").textContent], {
          type: "text/javascript",
        });
        worker_url = window.URL.createObjectURL(blob);
        console.log(worker_url);
      }, 300);
      setTimeout(connect, 1000);

      setTimeout(() => sourceLoading("cache"), 1500);
      setTimeout(() => {
        console.log("clear spin");
        document.getElementById("spin").classList.add("hidden");
      }, 2000);
    }

    // 重新建立緩存
    function refreshData() {
      localStorage.clear();
      localStorage.setItem("local_cache_name", cacheName);
      createCache(cacheList);
    }

    // 加入html
    function addHTML(data) {
      document.getElementById("ui_html").innerHTML += data;
    }

    // 加入js
    function addScript(data) {
      let script = document.createElement("script");
      script.type = "text/javascript";
      script.async = true;
      script.textContent = data;
      document.getElementsByTagName("head")[0].appendChild(script);
    }

    // 加入css
    function addStyle(data) {
      let style = document.createElement("style");
      style.id = "style";
      style.textContent = data;
      document.head.append(style);
    }

    // 加入worker程式
    function addWorker(data) {
      let script = document.createElement("script");
      script.id = "worker";
      script.type = "javascript/worker";
      script.textContent = data;
      document.getElementsByTagName("head")[0].appendChild(script);
    }

    // 加入manifest定義檔
    function addManifest(data) {
      let manifest = data.replace(/(\r\n|\n|\r| )/gm, "");
      manifest = "data:application/manifest+json," + manifest;
      document
        .querySelector("#manifest-placeholder")
        .setAttribute("href", manifest);
    }

    // 加入favicon
    function addIcon(data) {
      let manifest = JSON.parse(data.replace(/(\r\n|\n|\r| )/gm, ""));
      let ico = manifest.icons[0].src;
      document.querySelector("#icon").setAttribute("href", ico);
    }

    // 檢查瀏覽器是否支援localStorage，無則向server要求網頁檔案
    if (document.getElementById("build_check").innerText === "dev") {
      console.log("local developing...");
    } else if (!window.localStorage) {
      console.warn("Browser not support localStorage.");
      refreshData();
    }
    // 檢查檔案版本與用戶端版本是否一致
    else if (
      cacheName === local_cache_name &&
      code_html &&
      code_app &&
      code_src &&
      code_style &&
      code_worker &&
      code_manifest
    ) {
      console.log(`Find Cache: ${cacheName}, use cache file.`);
      useCachedData();
    } else {
      console.log(`Can't find cache, fetch fresh data and create new one.`);
      refreshData();
    }

    document.onreadystatechange = loading;

    // 完成Loading
    function loading() {
      if (document.readyState == "complete") {
        setTimeout(() => {
          document.getElementById("loading").style.display = "none";
        }, 1500);
        console.log("load success");
      }
    }
  </script>
  <script id="index_src">
    window.act;
    window.editCmd = 0;
    window.kM;
    window.paramCnt = 0;
    window.res_wifi = "";
    window.terminal_scroll = true;
    window.terminal_log = true;
    window.SYSDATA = {
      device: "",
      wifi: "",
      RSSI: "",
      LT: 0,
      bps: 0,
      SSbps: 0,
      ILWPR: "",
      ILWPSH: "",
      OLWPR: "",
      OLWPSH: "",
      PumpILStart: "",
      PumpILStartActID: "",
      PumpILStop: "",
      SMFull: "",
      SML: "",
      SMLActT: "",
      SMZero: "",
      STMODE: "",
      Stations: 0,
      FoehnHum: "",
      foehnOpT: "",
      FoehnTemp: "",
      Sched: [],
    };

    window.postCmd = function postCmd(str) {
      if (str === "") return;
      let jsonCmd = { SENDCMD: str };
      console.log(jsonCmd);
      if (!window.worker) {
        console.log("websocket not ready...");
        return;
      }
      try {
        window.worker.postMessage(jsonCmd);
      } catch (error) {
        console.log(error);
      }
    };

    function $(id) {
      return document.getElementById(id);
    }

    window.wkMsg = function wkMsg(e) {
      try {
        if (e.data instanceof Uint8Array) {
          e.data[0] === 0x00
            ? showSYS(e.data)
            : e.data[0] === 0x01
            ? showEEPROM(e.data)
            : 0;
        }
        window.dataFormatEntryPoint(e.data);
      } catch (error) {
        console.log(error);
      }
    };
    function clearMsg() {
      $("tx").value = "";
    }

    function showSYS(data) {
      len = data[1];
      len <<= 8;
      len += data[2];
      if (len < 4) return;
      lt = 0;
      //get lifetimr
      for (i = 3; i < 7; ++i) {
        lt <<= 8;
        lt += data[i];
      }
      $("LT").innerHTML = lt;
      SYSDATA["LT"] = lt;
      if (len < 32) return;
      // get softwareserial baudrate
      ssbps = 0;
      for (i = 32; i < 36; ++i) {
        ssbps <<= 8;
        ssbps += data[i];
      }
      $("SSbps").innerHTML = ssbps;
      SYSDATA["SSbps"] = ssbps;
    }

    function showEEPROM(data) {
      var str = "\t";
      for (i = 0; i < 16; ++i) {
        str += i < 16 ? "x" : "";
        str += i.toString(16);
        str += "\t";
      }
      str += "\n";
      ptr = 3;
      for (i = 0; i < 20; ++i) {
        str += i < 16 ? "0" : "";
        str += i.toString(16);
        str += "x";
        str += "\t";
        for (j = 0; j < 16; ++j) {
          var k = data[ptr++];
          str += k < 16 ? "0" : "";
          str += k.toString(16);
          str += "\t";
        }
        str += "\n";
      }
      $("tx").value = str;
    }

    // 顯示等待動畫
    function spin(flag) {
      flag
        ? $("spin").classList.remove("hidden")
        : $("spin").classList.add("hidden");
    }
  </script>
  <script id="index_app">
    window.btmMenu_previous = "btmMenu_sche";

    const CORE_CMD = {
      wifi_scan: "@ap scan",
      wifi_connect: (ssid, pwd) => {
        return `@ap connect [${ssid}]:[${pwd}]`;
      },
      wifi_reconnect: "@ap connect reconnect",
      wifi_reset: "@ap connect reset",
      device_set_name: (name) => {
        return `@set device id:${name}`;
      },
      device_set_ssid: (ssid, pwd) => {
        return `@set sap [${ssid}]:[${pwd}]`;
      },
      device_set_bps: (baud) => {
        return `@bps: ${baud}`;
      },
      device_set_SSbps: (baud) => {
        return `SS bps: ${baud}`;
      },
      sche_show: "schedule show",
      sche_add: (week, time, area_arr) => {
        return `schedule add Week:${week} H:M=${time} ${area_arr.join(" ")}`;
      },
      sche_save: "schedule save",
      sche_remove: (index) => {
        return `schedule remove ${index}`;
      },
      ws_ping: "@rssi?",
    };

    const CUSTOM_CMD = {
      wifi_set_addr: (addr) => {
        return `set recv Addr ${addr}`;
      },
      wifi_get_addr: "get recv Addr",
      system_setting: "system setting",
      system_set: (key, value) => {
        return `system setting ${key}: ${value}`;
      },
      system_save: "system setting save",
      file_write: "write DNA",
      file_get: "get DNA",
      file_remove: "remove file DNA.dat",
      modbus_add: (st, cycle, rds, key_arr) => {
        return `add station st:${st}|cycle:${cycle}|rds:${rds}|${key_arr.join(
          ""
        )}`;
      },
      modbus_show: "show station",
    };

    function $(id) {
      return document.getElementById(id);
    }

    /*------------Interface Action------------*/

    // bottom menu switch page
    function switch_page(target) {
      if (target.id === btmMenu_previous) {
        return;
      }
      if (btmMenu_previous === "home" || btmMenu_previous === "menu") {
        $(target.id).parentElement.classList.add("buttomMenu-selected");
        show_page(target.id.split("_")[1]);
      } else if (btmMenu_previous !== "") {
        $(btmMenu_previous).parentElement.classList.remove(
          "buttomMenu-selected"
        );
        $(target.id).parentElement.classList.add("buttomMenu-selected");
        show_page(target.id.split("_")[1]);
        hide_page(btmMenu_previous.split("_")[1]);
      }
      btmMenu_previous = target.id;
    }

    // show target page
    function show_page(target) {
      switch (target) {
        case "sche":
          localStorage.setItem("current_hash", location.hash);
          $("btmMenu_sche").parentElement.classList.add("buttomMenu-selected");
          $("sche_editor").classList.add("hidden");
          $("sche_page").classList.remove("hidden");
          $("sche_list").classList.remove("hidden");
          $("sche_list").scrollTo({
            top: 0,
            behavior: "smooth",
          });
          $("sche_btn_group").classList.remove("hidden");
          break;
        case "custom":
          localStorage.setItem("current_hash", location.hash);
          $("btmMenu_custom").parentElement.classList.add(
            "buttomMenu-selected"
          );
          $("custom_page").classList.remove("hidden");
          $("custom_list").scrollTo({
            top: 0,
            behavior: "instant",
          });
          break;
        case "network":
          localStorage.setItem("current_hash", location.hash);
          $("btmMenu_network").parentElement.classList.add(
            "buttomMenu-selected"
          );
          $("network_page").classList.remove("hidden");
          break;
        case "system":
          localStorage.setItem("current_hash", location.hash);
          $("btmMenu_system").parentElement.classList.add(
            "buttomMenu-selected"
          );
          $("system_page").classList.remove("hidden");
          $("system_list").scrollTo({
            top: 0,
            behavior: "instant",
          });
          break;
        case "terminal":
          localStorage.setItem("current_hash", location.hash);
          $("btmMenu_terminal").parentElement.classList.add(
            "buttomMenu-selected"
          );
          $("terminal_page").classList.remove("hidden");
          break;
        case "home":
          localStorage.setItem("current_hash", location.hash);
          $("menu_bottom").classList.add("hidden");
          $("mask_setting").classList.add("hidden");
          $("sche_page").classList.add("hidden");
          $("custom_page").classList.add("hidden");
          $("network_page").classList.add("hidden");
          $("system_page").classList.add("hidden");
          $("terminal_page").classList.add("hidden");
          $("btmMenu_sche").parentElement.classList.remove(
            "buttomMenu-selected"
          );
          $("btmMenu_custom").parentElement.classList.remove(
            "buttomMenu-selected"
          );
          $("btmMenu_network").parentElement.classList.remove(
            "buttomMenu-selected"
          );
          $("btmMenu_system").parentElement.classList.remove(
            "buttomMenu-selected"
          );
          $("btmMenu_terminal").parentElement.classList.remove(
            "buttomMenu-selected"
          );
          $("body").classList.remove("overflow-hidden");
          break;

        default:
          break;
      }
    }

    // hide target page
    function hide_page(target) {
      switch (target) {
        case "sche":
          $("sche_page").classList.add("hidden");
          clearScheduleAdd();
          break;
        case "custom":
          $("custom_page").classList.add("hidden");
          break;
        case "network":
          $("network_page").classList.add("hidden");
          break;
        case "system":
          $("system_page").classList.add("hidden");
          break;
        case "terminal":
          $("terminal_page").classList.add("hidden");
          break;
        case "home":
          $("menu_bottom").classList.remove("hidden");
          $("mask_setting").classList.remove("hidden");
          $("mask").classList.add("hidden");
          $("menu").classList.add("hidden");
          break;
        default:
          break;
      }
    }

    // open setting menu
    $("open-menu").addEventListener("click", () => {
      switchMenu(1);
    });

    // close setting menu
    $("mask").addEventListener("click", () => {
      switchMenu(0);
    });

    function switchMenu(flag) {
      if (flag) {
        window.location.hash = "#menu";
        localStorage.setItem("current_hash", location.hash);
        $("mask").classList.remove("hidden");
        $("menu").classList.remove("hidden");
        $("body").classList.add("overflow-hidden");
      } else {
        window.location.hash = "#home";
        $("mask").classList.add("hidden");
        $("menu").classList.add("hidden");
        $("body").classList.remove("overflow-hidden");
      }
    }

    // switch to schedule page(show)
    $("open-sche").addEventListener("click", () => {
      window.location.hash = "#sche";
    });

    $("btmMenu_sche").addEventListener("click", (e) => {
      if (btmMenu_previous === "btmMenu_sche") return;
      window.location.hash = "#sche";
    });

    $("sche_btn_cancel").addEventListener("click", () => {
      show_page("sche");
    });

    // switch to schedule page(edit)
    $("sche_btn_add").addEventListener("click", () => {
      if (SYSDATA.STMODE !== "停止" && SYSDATA.STMODE !== "手動") {
        alert("停止或手動模式下才可修改排程");
        return;
      }
      $("sche_list").classList.add("hidden");
      $("sche_btn_group").classList.add("hidden");
      $("sche_editor").classList.remove("hidden");
      updateScheduleArea();
    });

    // update schedule page(show)
    // data-struct: [["W1",11,50,2,2,0,0,0,0,0,0],["W1",14,16,1,0,1,1,1,1,0,0]]
    function updateSchedulePage() {
      $("sche_list").innerHTML = "";
      let data = SYSDATA.Sched;
      // define DOM elements
      let div;
      let table;
      let tbody;
      let tr;
      let td;
      let input;
      let lable;
      let span;
      // create schedule elements
      for (let i = data.length - 1; i > -1; i--) {
        // get one schedule data
        let sche_data = data[i];

        // make 7 check box
        let week = sche_data[0].split("W")[1].split("");

        tbody = document.createElement("tbody");
        td = document.createElement("td");
        td.innerText = "X";
        td.className = "schedule-remove";
        td.onclick = (e) => {
          if (SYSDATA.STMODE !== "停止" && SYSDATA.STMODE !== "手動") {
            alert("停止或手動模式下才可修改排程");
            return;
          }
          let result = confirm("確認是否刪除排程？");
          if (result) {
            let index = getChildElementIndex(
              e.target.parentElement.parentElement.parentElement
            );
            let r = data.length + 1 - index;
            index = index + (r - index) - 2;
            removeSchedule(index);
          }
        };
        tbody.append(td);

        // td = document.createElement("td");
        // td.innerText = "週";
        // tbody.append(td);

        for (let j = 0; j < 7; j++) {
          input = document.createElement("input");
          span = document.createElement("span");
          lable = document.createElement("label");
          td = document.createElement("td");
          input.type = "checkbox";
          input.disabled = true;

          if (week.length > 0 && week[0] == j + 1) {
            week.shift();
            input.checked = true;
          }

          if (j === 0) span.innerText = "一";
          if (j === 1) span.innerText = "二";
          if (j === 2) span.innerText = "三";
          if (j === 3) span.innerText = "四";
          if (j === 4) span.innerText = "五";
          if (j === 5) span.innerText = "六";
          if (j === 6) span.innerText = "日";

          lable.append(input);
          lable.append(span);
          td.append(lable);
          tbody.append(td);
        }

        let table_week = document.createElement("table");
        table_week.className = "schedule-week";
        table_week.append(tbody);

        // make schedule area
        span = document.createElement("span");
        div = document.createElement("div");
        let min =
          sche_data[2] == 0
            ? "00"
            : sche_data[2] < 10
            ? `0${sche_data[2]}`
            : sche_data[2];
        span.innerText = `${sche_data[1]}:${min}`;
        div.className = "schedule-time";
        div.append(span);

        let div_container = document.createElement("div");
        div_container.className = "schedule-container";
        div_container.append(div);

        tr = document.createElement("tr");
        tbody = document.createElement("tbody");

        for (let k = 0; k < parseInt(SYSDATA.Stations); k++) {
          td = document.createElement("td");
          if (sche_data[k + 3] > 0) {
            td.className = "schedule-exec";
          } else {
            td.className = "schedule-close";
          }
          td.innerText = `${k + 1}區`;
          tr.append(td);
        }

        tbody.append(tr);
        tr = document.createElement("tr");
        tr.style.height = "4rem";
        for (let l = 0; l < parseInt(SYSDATA.Stations); l++) {
          td = document.createElement("td");
          if (sche_data[l + 3] > 0) {
            td.className = "schedule-exec";
          } else {
            td.className = "schedule-close";
          }
          td.innerText = sche_data[l + 3];
          tr.append(td);
        }

        tbody.append(tr);

        table = document.createElement("table");
        table.className = "schedule-area";
        table.append(tbody);
        div_container.append(table);

        // make schedule
        div = document.createElement("div");
        div.className = "schedule";
        div.append(table_week);
        div.append(div_container);

        document.getElementById("sche_list").append(div);
      }
    }

    // switch to custom page
    $("open-custom").addEventListener("click", () => {
      window.location.hash = "#custom";
    });
    $("btmMenu_custom").addEventListener("click", (e) => {
      if (btmMenu_previous === "btmMenu_custom") return;
      window.location.hash = "#custom";
    });

    // update custom page

    // switch to network page
    $("open-network").addEventListener("click", () => {
      window.location.hash = "#network";
    });
    $("btmMenu_network").addEventListener("click", (e) => {
      if (btmMenu_previous === "btmMenu_network") return;
      window.location.hash = "#network";
    });

    // update wifi list

    // switch to system page
    $("open-system").addEventListener("click", () => {
      window.location.hash = "#system";
    });
    $("btmMenu_system").addEventListener("click", (e) => {
      if (btmMenu_previous === "btmMenu_system") return;
      window.location.hash = "#system";
    });

    // switch to terminal page
    $("open-terminal").addEventListener("click", () => {
      window.location.hash = "#terminal";
    });
    $("btmMenu_terminal").addEventListener("click", (e) => {
      if (btmMenu_previous === "btmMenu_terminal") return;
      window.location.hash = "#terminal";
    });

    // back to home page
    $("btmMenu_close").addEventListener("click", () => {
      window.location.hash = "#home";
    });

    // hide bottom menu when focus input
    document.querySelectorAll('input[name="float-input"]').forEach((e) => {
      // console.log(e);
      if (window.innerWidth > 768) return;
      e.addEventListener("focus", (el) => {
        // console.log(el.target.id + " focus");
        $("menu_bottom").classList.add("hidden");
      });
      e.addEventListener("blur", (el) => {
        // console.log(el.target.id + " blur");
        $("menu_bottom").classList.remove("hidden");
      });
    });

    /*------------Command Action------------*/

    // clear all running interval
    function createClearAllInterval() {
      const noop = () => {};
      let firstId = setInterval(noop, 0);

      return () => {
        const lastId = setInterval(noop, 0);
        while (firstId !== lastId) {
          firstId += 1;
          clearInterval(firstId);
        }
      };
    }

    var clearAllInterval = createClearAllInterval();

    /** Schedule */

    // create control option of time
    function createControlOption(maxTime) {
      for (let i = 0; i < SYSDATA.Stations; i++) {
        $(`sche_add_area_${i + 1}`).innerHTML = "";
        for (let j = 0; j < maxTime + 1; j++) {
          let op = document.createElement("option");
          op.innerText = j;
          $(`sche_add_area_${i + 1}`).appendChild(op);
        }
      }
    }

    function getOptionValue(id) {
      return $(id).options[$(id).selectedIndex].value;
    }

    // add new schedule
    function addSchedule() {
      let week = "";
      for (let i = 0; i < 7; i++) {
        if ($(`sche_add_w${i + 1}`).checked) {
          week += i + 1;
        }
      }
      if (week === "") {
        alert("至少選擇一個星期");
        return;
      }
      let time = $("sche_add_time").value;
      if (time === "") {
        alert("請選擇灑水時段");
        return;
      }
      let area = [];
      for (let j = 0; j < SYSDATA.Stations; j++) {
        area.push(`ST${j + 1}:` + getOptionValue(`sche_add_area_${j + 1}`));
      }
      if (
        area.filter((t) => t.split(":")[1] > 0 && t.split(":")[1] <= 30)
          .length < 1
      ) {
        alert(
          "至少設定一區有效的灑水時間,為防止電磁閥過熱，每站上限為30分鐘。"
        );
        return;
      }

      postCmd(CORE_CMD.sche_add(week, time, area));

      clearScheduleAdd();
      spin(1);

      setTimeout(() => {
        spin(0);
        btmMenu_previous = "btmMenu_sche";
        hide_page("home");
        show_page("sche");
        updateSchedulePage();
        postCmd(CORE_CMD.sche_save);
        alert("新增排程完成，若需要自動控制，請回到首頁將模式切換回自動。");
      }, 2000);
    }

    $("sche_btn_confirm").addEventListener("click", () => {
      addSchedule();
    });

    // remove schedule
    function removeSchedule(index) {
      spin(1);
      postCmd(CORE_CMD.sche_remove(index));
      setTimeout(() => {
        spin(0);
        updateSchedulePage();
        postCmd(CORE_CMD.sche_save);
      }, 2000);
    }

    // update schedule
    $("sche_btn_update").addEventListener("click", () => {
      postCmd(CORE_CMD.sche_show);
      $("sche_list").innerHTML = "";
      spin(1);
      setTimeout(() => {
        spin(0);
        if (SYSDATA.Sched.length === 0) {
          alert("無任何設定排程");
          return;
        }
        updateSchedulePage();
      }, 1500);
    });

    // clear schedule edit
    function clearScheduleAdd() {
      for (let i = 0; i < 7; i++) {
        $(`sche_add_w${i + 1}`).checked = false;
      }
      $("sche_add_time").value = "";
      for (let j = 0; j < SYSDATA.Stations; j++) {
        $(`sche_add_area_${j + 1}`).selectedIndex = 0;
      }
    }

    // set num of editable area
    function updateScheduleArea() {
      for (let i = 0; i < 8; i++) {
        if (i < parseInt(SYSDATA.Stations)) {
          $(`area_title_${i + 1}`).classList.remove("hidden");
          $(`area_input_${i + 1}`).classList.remove("hidden");
        } else {
          $(`area_title_${i + 1}`).classList.add("hidden");
          $(`area_input_${i + 1}`).classList.add("hidden");
        }
      }
    }

    /** Network */

    // scan wifi
    $("network_btn_scan").addEventListener("click", () => {
      scanWifi();
      spin(1);
    });
    var scanHandler;
    // 搜尋並顯示結果
    function scanWifi() {
      var timeout = 0;
      var res = "";
      var wr = $("wifi-result");
      var wf = $("network_btn_scan");
      res_wifi = "";
      wr.innerHTML = "";
      postCmd(CORE_CMD.wifi_scan);
      wf.disabled = true;
      var div = document.createElement("div");
      wr.appendChild(div);
      scanHandler = setInterval(() => {
        timeout += 1;
        if (timeout >= 10) {
          spin(0);
          alert("已逾時，請重新搜尋。");
          clearInterval(scanHandler);
          wr.innerHTML = "";
          wf.disabled = false;
          return;
        }
        if (res_wifi) {
          spin(0);
          res = res_wifi;
          wr.innerHTML = "";
          var res_result = res.split("|");
          res_result.forEach((e) => {
            if (e === "") return;
            var li = document.createElement("li");
            var btn = document.createElement("input");
            btn.className = "w-btn";
            btn.type = "button";
            btn.value = e;
            btn.onclick = () => inputWifiPWD(e);
            li.appendChild(btn);
            wr.appendChild(li);
          });
          clearInterval(scanHandler);
          wf.disabled = false;
        }
      }, 1000);
    }

    // connect selected wifi
    function inputWifiPWD(e) {
      let pwd = prompt(`SSID: ${e},Wifi密碼: `);
      if (pwd === null) {
        return;
      }
      postCmd(CORE_CMD.wifi_connect(e, pwd));
    }

    // reconnect the last connected wifi
    $("network_btn_reconnect").addEventListener("click", () => {
      postCmd(CORE_CMD.wifi_reconnect);
      spin(1);
      setTimeout(() => {
        spin(0);
      }, 1000);
    });

    // set recv socket address
    $("network_btn_set_socket").addEventListener("click", () => {
      let v = prompt("請輸入Socket Server位址：");
      if (!v) return;
      postCmd(CUSTOM_CMD.wifi_set_addr(v));
      spin(1);
      setTimeout(() => {
        postCmd(CUSTOM_CMD.wifi_get_addr);
      }, 500);
      setTimeout(() => {
        spin(0);
      }, 1000);
    });

    // get recv socket address
    $("network_btn_get_socket").addEventListener("click", () => {
      postCmd(CUSTOM_CMD.wifi_get_addr);
      spin(1);
      setTimeout(() => {
        spin(0);
      }, 500);
    });

    /** System */

    // set device name
    $("system_set_device").addEventListener("click", () => {
      let name = prompt("請輸入裝置名稱:");
      if (!name) {
        alert("請輸入至少一個字");
        return;
      }
      postCmd(CORE_CMD.device_set_name(name));
    });

    // set SSID
    $("system_set_ssid").addEventListener("click", () => {
      let ssid = prompt("請輸入SSID:");
      if (!ssid) {
        alert("格式不符，請重試");
        return;
      }
      let pwd = prompt("請輸入8~16位密碼:");
      if (!pwd) {
        alert("格式不符，請重試");
        return;
      }
      let result = confirm(`確定更改為 wifi名稱: ${ssid}, 密碼: ${pwd} ?`);
      if (result) {
        postCmd(CORE_CMD.device_set_ssid(ssid, pwd));
      }
    });

    // set UART baud
    $("system_set_bps").addEventListener("click", () => {
      let baud = prompt("請輸入serial baud rate:");
      if (!baud) {
        return;
      }
      postCmd(CORE_CMD.device_set_bps(baud));
      spin(1);
      setTimeout(() => {
        spin(0);
      }, 500);
    });

    // set SS bps
    $("system_set_SSbps").addEventListener("click", () => {
      let baud = prompt("請輸入soft serial baud rate:");
      if (!baud) {
        return;
      }
      postCmd(CORE_CMD.device_set_SSbps(baud));
      spin(1);
      setTimeout(() => {
        spin(0);
      }, 500);
    });

    // reload fresh data
    $("system_reload").addEventListener("click", () => {
      let result = confirm("確認強制重新整理?");
      if (result) {
        reloadWeb();
      }
    });

    // update system page
    function updateSystemPage() {
      $("system_device").innerText = SYSDATA.device;
    }

    /** Terminal */

    // send command
    $("terminal_send").addEventListener("click", () => {
      let cmd = $("cmd_input").value;
      if (cmd === "config") {
        $("btmMenu_custom_btn").classList.remove("hidden");
        return;
      }
      postCmd(cmd);
      $("cmd_input").value = "";
    });

    // clear log
    $("terminal_clear").addEventListener("click", () => {
      $("tx").value = "";
    });

    // auto scroll
    $("terminal_scroll").addEventListener("click", () => {
      if (window.terminal_scroll) {
        window.terminal_scroll = false;
        $("terminal_scroll").innerText = "捲動: OFF";
        $("terminal_scroll").classList.remove("success");
        $("terminal_scroll").classList.add("default");
      } else {
        window.terminal_scroll = true;
        $("terminal_scroll").innerText = "捲動: ON";
        $("terminal_scroll").classList.add("success");
        $("terminal_scroll").classList.remove("default");
      }
    });

    // enable/disable log
    $("terminal_log").addEventListener("click", () => {
      if (window.terminal_log) {
        window.terminal_log = false;
        $("terminal_log").innerText = "Log: OFF";
        $("terminal_log").classList.remove("success");
        $("terminal_log").classList.add("default");
      } else {
        window.terminal_log = true;
        $("terminal_log").innerText = "Log: ON";
        $("terminal_log").classList.add("success");
        $("terminal_log").classList.remove("default");
      }
    });

    /** System setting */
    function callSystemSetting(cmd) {
      spin(1);
      postCmd(cmd);
      setTimeout(() => {
        postCmd(CUSTOM_CMD.system_setting);
        spin(0);
      }, 1000);
    }

    // 顯示等待動畫
    function spin(flag) {
      flag
        ? $("spin").classList.remove("hidden")
        : $("spin").classList.add("hidden");
    }

    // 顯示等待動畫(秒數)
    window.spinWithTime = function (s) {
      $("spin").classList.remove("hidden");
      setTimeout(() => {
        $("spin").classList.add("hidden");
      }, s * 1000);
    };

    function getChildElementIndex(node) {
      console.log(node);
      return Array.prototype.indexOf.call(node.parentElement.children, node);
    }

    // 清除緩存並重新整理
    window.reloadWeb = () => {
      localStorage.clear();
      window.location.reload();
    };

    window.addEventListener("hashchange", () => {
      console.log("hashchange: " + location.hash);
      switch (location.hash) {
        case "#home":
          show_page("home");
          switchMenu(0);
          btmMenu_previous = "home";
          break;
        case "#menu":
          show_page("home");
          switchMenu(1);
          btmMenu_previous = "menu";
          break;
        case "#sche":
          switch_page($("btmMenu_sche"));
          $("sche_list").innerHTML = "";
          postCmd(CORE_CMD.sche_show);
          spin(1);
          setTimeout(() => {
            spin(0);
            if (SYSDATA.Sched.length === 0) {
              alert("無任何設定排程");
              return;
            }
            updateSchedulePage();
          }, 1500);
          createControlOption(30);
          btmMenu_previous = "btmMenu_sche";
          hide_page("home");
          break;
        case "#custom":
          switch_page($("btmMenu_custom"));
          btmMenu_previous = "btmMenu_custom";
          hide_page("home");
          break;
        case "#network":
          switch_page($("btmMenu_network"));
          btmMenu_previous = "btmMenu_network";
          hide_page("home");
          postCmd(CORE_CMD.ws_ping);
          break;
        case "#system":
          switch_page($("btmMenu_system"));
          btmMenu_previous = "btmMenu_system";
          hide_page("home");
          updateSystemPage();
          break;
        case "#terminal":
          switch_page($("btmMenu_terminal"));
          btmMenu_previous = "btmMenu_terminal";
          hide_page("home");
          break;

        default:
          window.location.hash = "#home";
          console.log("not vaild hash, back to home.");
          break;
      }
    });
  </script>
  <script id="index_worker">
    var ws = undefined; //定義ws全域變數
    var argv = {}; //定義argv全域變數物件
    var timeout = 5000; // 檢查是否過久未傳送命令

    /**
     * 當websocket連線成功時呼叫，顯示訊息於console
     */
    function WSOn(e) {
      console.log("websocket connected");
    }

    /**
     * 當websocket連接斷開時呼叫，呼叫newWS產生新的websocket連接
     */
    function WSCe(e) {
      ws.close();
      ws = undefined;
      console.log("connection lost\r\nreconnect...");
      newWS(argv["wsStr"]);
    }

    /**
     * 接收到的資料轉換成json物件，透過呼叫self.postMessage觸發index.js中的onmessage方法，將資料傳送至網頁
     */
    function WSMsg(e) {
      try {
        if (e.data instanceof Blob) {
          new Response(e.data).arrayBuffer().then(function (buffer) {
            arr = new Uint8Array(buffer);
            self.postMessage(arr);
          });
          return;
        }
        if (e.data === undefined || e.data.indexOf('{"') != 0) {
          return;
        }
        if (e.data.includes("content") && e.data.includes("from")) {
          let ip = e.data
            .substring(e.data.indexOf("REQ:") + 4, e.data.indexOf('"}'))
            .split("from ")[1]
            .split("\r\n")[0];
          self.postMessage(JSON.parse(`{"tx":"IP:${ip}"}`));
          return;
        }
        jsData = JSON.parse(e.data);
        self.postMessage(jsData);
      } catch (error) {
        self.postMessage(e.data);
        console.error(error);
        return;
      }
    }

    /**
     * 當websocket出現錯誤/例外情況時呼叫，顯示訊息於console
     */
    function WSErr(e) {
      console.log(e.data);
    }

    /**
     * 產生websocket連接，str爲目標IP位址
     */
    function newWS(str) {
      argv["wsStr"] = str;
      console.log("Connect: " + argv["wsStr"]);
      ws = new WebSocket(argv["wsStr"]);
      if (ws) {
        ws.onopen = WSOn;
        ws.onclose = WSCe;
        ws.onmessage = WSMsg;
        ws.onerror = WSErr;
      }
      return ws;
    }

    /**
     * 當worker接收到對應key值的資料時執行對應程式
     */
    function wkMsg(e) {
      for (i in e.data) {
        switch (i) {
          case "URL":
            argv["url"] = e.data["URL"];
            break;
          case "SENDCMD":
            ws.send(e.data["SENDCMD"]);
            timeout = 5000;
            break;
          default:
            break;
        }
      }
    }

    // 初始化產生websocket連接，成功則進入下一階段，失敗則每秒重新嘗試連接直到成功
    function stage1() {
      // console.log(argv["url"]);
      if (argv["url"] !== undefined) {
        if (ws === undefined) {
          // ws = newWS(
          //   argv["url"].indexOf("http://") != -1
          //     ? argv["url"].split("#")[0].replace("http://", "ws://")
          //     : "ws://10.10.10.10/"
          // );
          ws = newWS("ws://10.10.10.10/");
          if (ws) {
            f = stage2;
          }
        }
      }
      setTimeout("f()", 1000);
    }

    //第二階段，每5秒傳送訊息確認MCU是否存活
    function stage2() {
      if (ws.readyState == 1) {
        // ws.send("RSSI?");
      }
      // self.postMessage({ RSSI: "<---->" });
      setTimeout("f()", 5000);
    }
    onmessage = wkMsg;
    f = stage1;
    f();

    setInterval(() => {
      try {
        if (timeout > 0) {
          timeout -= 100;
        } else if (timeout == 0) {
          timeout = 5000;
          ws.send("@rssi?");
          self.postMessage({ RSSI: "<---->" });
        }
      } catch (error) {}
    }, 100);
  </script>
  <script id="index_manifest" type="text">
      {
      "name": "BEExANT MCU Web",
      "short_name": "BEExANT MCU Web",
      "icons": [
        {
          "src": "data:image/svg+xml;base64,PHN2ZyBpZD0iTE9HTyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMjA1LjY3IDI5Ni44MiIgZmlsbD0iIzU4YjJkYyI+DQogIDx0aXRsZT5C77yGQV9TVkc8L3RpdGxlPg0KICA8Zz4NCiAgICA8cGF0aCBkPSJNMTUxLjU0LDEzNy40N2EzLjQ1LDMuNDUsMCwxLDEtMy40NS0zLjQ0QTMuNDYsMy40NiwwLDAsMSwxNTEuNTQsMTM3LjQ3WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTg1Ljg3IC01MC44MSkiLz4NCiAgICA8cGF0aCBkPSJNMTUxLjU0LDE0Ny4xNGEzLjQ1LDMuNDUsMCwxLDEtMy40NS0zLjQ1QTMuNDUsMy40NSwwLDAsMSwxNTEuNTQsMTQ3LjE0WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTg1Ljg3IC01MC44MSkiLz4NCiAgICA8cGF0aCBkPSJNMjg5Ljc2LDI0NS4yMywyMTIuNTksMTUyYTQuNDMsNC40MywwLDAsMCwuMjYtMS40NXYtMTYuMmE0LjQ0LDQuNDQsMCwwLDAtMi4xOS0zLjc4bC0xNC45MS05LjA2LDEwLjg5LTE0Yy4wNi0uMDcuMDktLjE2LjE1LS4yNGE0LjMxLDQuMzEsMCwwLDAtLjM1LTUuNTVMMTkxLjE2LDg1LjQ4YTUsNSwwLDAsMC02LjcyLS4zNyw0LjMzLDQuMzMsMCwwLDAtLjM5LDYuMzVMMTk2Ljc4LDEwNWwtMTAuNDIsMTMuNDRoLTguMDdWODIuNTZsMjctMjQuODlhMy44NSwzLjg1LDAsMCwwLC4wOC01LjY2LDQuNDIsNC40MiwwLDAsMC02LS4wN0wxNzEuNjQsNzcuNTJhMy45MywzLjkzLDAsMCwwLS41MS41OCwzLjg1LDMuODUsMCwwLDAtMS4zLDIuODd2MzcuNDVIMTY3LjZhNC4yLDQuMiwwLDAsMC0uNjIuMDYsNC4zNCw0LjM0LDAsMCwwLS42My0uMDZoLTEuOVY4M2E0LDQsMCwwLDAtMi4wNi0zLjQyYy0uMDktLjA2LS4xNy0uMTQtLjI3LS4ybC0xMi41NC03LjYsMTEuNDctMTEuMTZhMy44NCwzLjg0LDAsMCwwLS4wOC01LjY1LDQuNDEsNC40MSwwLDAsMC02LC4wOEwxNDAuNyw2OC45MWMtLjExLjExLS4yLjI0LS4zLjM2YTQuMTUsNC4xNSwwLDAsMC0xLjA1LDEsMy44OCwzLjg4LDAsMCwwLDEuMjgsNS41M0wxNTYsODUuMTR2MzMuMjhoLTlMMTM2LjU4LDEwNWwxMi43My0xMy41MmE0LjMyLDQuMzIsMCwwLDAtLjM5LTYuMzUsNSw1LDAsMCwwLTYuNzIuMzdMMTI2LjkzLDEwMS43YTQuMjksNC4yOSwwLDAsMC0uMzUsNS41NSwxLjk0LDEuOTQsMCwwLDAsLjE1LjI0bDExLjA4LDE0LjI4LTE0LjUyLDguODJhNC40NCw0LjQ0LDAsMCwwLTIuMTksMy43OHYxNi4yYTQuNDcsNC40NywwLDAsMCwyLjE5LDMuNzlMMTM3LDE2Mi42OGwtNTAuNSw3NS4wOWMwLC4wNi0uMDYuMTMtLjEuMTlzLS4xNC4yNS0uMi4zOC0uMS4yNC0uMTQuMzYtLjA4LjI0LS4xMS4zNywwLC4yNi0uMDYuMzlhMi4zMSwyLjMxLDAsMCwwLDAsLjM3YzAsLjEzLDAsLjI2LDAsLjM5czAsLjI2LjA1LjM4TDg2LDI0MWMwLC4xMS4wOC4yMy4xMy4zNWEyLjkzLDIuOTMsMCwwLDAsLjE5LjRjMCwuMDYsMCwuMTIuMDkuMTlsNjMuNzQsMTAzLjdhNC4yOSw0LjI5LDAsMCwwLDMuNjcsMiw0LjM3LDQuMzcsMCwwLDAsMi4xMi0uNTRsLjIxLS4xNC4yLS4xNC4zOS0uM2MuMTItLjExLjIzLS4yMy4zNC0uMzVsLjE1LS4xOGEzLjgyLDMuODIsMCwwLDAsLjg2LTIuMzlWMjIwYTQsNCwwLDAsMC00LjA5LTVoLTE2LjNhOC41NCw4LjU0LDAsMCwwLTcuMzItNCw4LDgsMCwxLDAsMCwxNiw4LjU2LDguNTYsMCwwLDAsNy4zMi00aDExLjkzdjMwLjE2SDEzNy43MmE4LjU0LDguNTQsMCwwLDAtNy4zMi00LDgsOCwwLDEsMCwwLDE2LDguNTQsOC41NCwwLDAsMCw3LjMyLTRoMTEuOTN2NjcuN0w5NSwyNDBsNDkuNDItNzMuNS4yNywwaDE4Ljc1VjI3MS40N2E0LDQsMCwwLDAsLjEuODUsNC4xMyw0LjEzLDAsMCwwLDQuMTksMy42MmgyMy40OGE4LjU0LDguNTQsMCwwLDAsNy4zMiw0LDgsOCwwLDEsMCwwLTE2LDguNTQsOC41NCwwLDAsMC03LjMyLDRIMTcydi0zMS4zaDEzYTguNTQsOC41NCwwLDAsMCw3LjMyLDQsOCw4LDAsMSwwLDAtMTYsOC41NCw4LjU0LDAsMCwwLTcuMzIsNEgxNzJWMTk5LjE2YTQuMjQsNC4yNCwwLDAsMCwuODguMDloNi40M2E4LjU0LDguNTQsMCwwLDAsNy4zMiw0LDgsOCwwLDEsMCwwLTE2LDguNTQsOC41NCwwLDAsMC03LjMyLDRoLTYuNDNhNC4yNCw0LjI0LDAsMCwwLS44OC4wOVYxNjYuNTNoMTcuMjdhNC45NCw0Ljk0LDAsMCwwLDIuNTgtLjcybDUuNTgtMy4zOUwyMjQsMjc3LjMyYTQuNTEsNC41MSwwLDAsMC0xLjMzLjYzbC01MS4xOCwzNi42N2MtLjA4LjA1LS4xMy4xMi0uMi4xN2EyLjI4LDIuMjgsMCwwLDAtLjMzLjI5LDIuNTUsMi41NSwwLDAsMC0uMjYuM2wtLjI0LjMxYy0uMDcuMTEtLjEzLjIzLS4xOS4zNHMtLjEyLjIzLS4xNy4zNWEyLjc4LDIuNzgsMCwwLDAtLjEyLjM4YzAsLjEyLS4wNy4yNC0uMS4zN3MwLC4yOCwwLC40M2EyLDIsMCwwLDAsMCwuMjR2MjUuNjdhNC4yNCw0LjI0LDAsMCwwLDguNDYsMFYzMTkuNzlsNDkuNTEtMzUuNDZhNCw0LDAsMCwwLC43NS0uNzJsNDkuMzYsMTIuNzJhNC4zNSw0LjM1LDAsMCwwLDUtMi4yNSwzLjg1LDMuODUsMCwwLDAsLjQ3LTEuMjVsOC4xMS00My42N0EzLjg5LDMuODksMCwwLDAsMjg5Ljc2LDI0NS4yM1pNMTMwLjI1LDIyMi42MWEzLjgxLDMuODEsMCwxLDEsNC0zLjgxQTMuOTIsMy45MiwwLDAsMSwxMzAuMjUsMjIyLjYxWm0wLDM4LjExYTMuODEsMy44MSwwLDEsMSw0LTMuOEEzLjkxLDMuOTEsMCwwLDEsMTMwLjI1LDI2MC43MlpNMTk4Ljg5LDI2OGEzLjgxLDMuODEsMCwxLDEtNCwzLjhBMy45MiwzLjkyLDAsMCwxLDE5OC44OSwyNjhabS02LjY0LTM5LjE3YTMuODEsMy44MSwwLDEsMS00LDMuODFBMy45MywzLjkzLDAsMCwxLDE5Mi4yNSwyMjguODNabS01LjU4LTM3LjM5YTMuODEsMy44MSwwLDEsMS00LDMuODFBMy45MiwzLjkyLDAsMCwxLDE4Ni42NywxOTEuNDRabTE2LjY2LTQzLjMzLTE1LjUsOS40MkgxNjcuNmE0LjIsNC4yLDAsMCwwLS42Mi4wNiw0LjM0LDQuMzQsMCwwLDAtLjYzLS4wNkgxNDYuMTNsLTE1LjUxLTkuNDJWMTM2LjgzbDE1LjUxLTkuNDFoMjAuMjJjLjIyLDAsLjQyLDAsLjYzLS4wNmE2LjIsNi4yLDAsMCwwLC42Mi4wNmgyMC4yM2wxNS41LDkuNDFabTcyLjQzLDEzOS4zOC00My4zMS0xMS4xN0wyMDUsMTU3LjgxbDEuMTEtLjY3LDc2LjY5LDkyLjYzWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTg1Ljg3IC01MC44MSkiLz4NCiAgICA8cGF0aCBkPSJNMjI4LjU4LDM0My43N2wtMi4yNiwzLjg1YTU5LjksNTkuOSwwLDAsMS03LjExLTUuMDksMTYuMDgsMTYuMDgsMCwwLDEtMTEuODMsNXEtNy4zNywwLTEwLjctNC40N2ExMC4wOSwxMC4wOSwwLDAsMS0xLjg1LTYuMDdxMC01LjE0LDUuNi05LjMyYy43Ni0uNTUsMS42My0xLjEzLDIuNjMtMS43NXEtMy4zLTQuNzktMy4zLTljMC0zLjU3LDEuMzEtNi4yLDMuOTEtNy44OGE5Ljc3LDkuNzcsMCwwLDEsNS4yNS0xLjQ0cTUuMDYsMCw3LjIxLDMuNmE4LjI3LDguMjcsMCwwLDEsMS4xMyw0LjI4cTAsNC44My01LjM1LDguOTVjLS44Ni42NS0xLjkyLDEuMzktMy4xOSwyLjIxQTEwMC41NSwxMDAuNTUsMCwwLDAsMjE5LDMzNi41MWEyNC4xOSwyNC4xOSwwLDAsMCw0LjI3LTEwLjM0aDQuNDJBMzQuNzEsMzQuNzEsMCwwLDEsMjIyLDMzOS4wOCw1NC41Niw1NC41NiwwLDAsMCwyMjguNTgsMzQzLjc3Wm0tMjkuMzMtNi45NWE2LjIxLDYuMjEsMCwwLDAsNCw2LjA3LDExLjMsMTEuMywwLDAsMCw0LjUzLjg4cTQuMzgtLjA2LDguMzQtNGExMDYuMTcsMTA2LjE3LDAsMCwxLTEwLjkxLTEwLjljLTMuMDksMi4wNS01LDQtNS42MSw1Ljg2QTYuMjEsNi4yMSwwLDAsMCwxOTkuMjUsMzM2LjgyWm00LjUzLTIwLjEyYzAsMi4wNiwxLDQuNDQsMi44Myw3LjE1cTQuNzItMi45Myw2LTUuM2E2LjE3LDYuMTcsMCwwLDAsLjc3LTIuOTMsNC4zMSw0LjMxLDAsMCwwLTIuMjEtNC4wN0E0LjU5LDQuNTksMCwwLDAsMjA5LDMxMWE0LjY0LDQuNjQsMCwwLDAtNC43OSwzLjA5QTcsNywwLDAsMCwyMDMuNzgsMzE2LjdaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtODUuODcgLTUwLjgxKSIvPg0KICAgIDxnPg0KICAgICAgPHBhdGggZD0iTTIyMy42LDMxOS4xNlYyOTUuODNoNy43M3E4LjQuMDYsOC40NCw1Ljc1YTUuNDQsNS40NCwwLDAsMS0xLjY3LDQuMSw0LjQ1LDQuNDUsMCwwLDEtMS41MS45MnYuMTlhNS4xNiw1LjE2LDAsMCwxLDQuMTMsMy42Niw2Ljg5LDYuODksMCwwLDEsLjI1LDEuODUsNiw2LDAsMCwxLTQuMTksNiwxMi43OSwxMi43OSwwLDAsMS00LjgzLjgzWm00LjY4LTEzLjg1SDIzMWMyLjY5LS4xOSw0LjExLTEuMiw0LjI1LTMuMDUsMC0xLjU0LS44Ni0yLjQ1LTIuNTktMi43NGE5LjU3LDkuNTcsMCwwLDAtMS42LS4xMmgtMi43N1ptMCwxMC4yNWgzLjI0cTQuODksMCw0LjkyLTMuNTQtLjA2LTMuMTktNC45Mi0zLjIzaC0zLjI0WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTg1Ljg3IC01MC44MSkiLz4NCiAgICAgIDxwYXRoIGQ9Ik0yNTIuMzYsMzE5LjU5YTguMjgsOC4yOCwwLDAsMS02LjYyLTIuODYsOS40NSw5LjQ1LDAsMCwxLTIuMTYtNi4zNyw5LjM2LDkuMzYsMCwwLDEsMy03LjI0LDcuNjksNy42OSwwLDAsMSw1LjI2LTIuMDYsNi41OCw2LjU4LDAsMCwxLDYuMzEsMy42LDEwLjM4LDEwLjM4LDAsMCwxLDEuMDgsNC44Nyw3LjgzLDcuODMsMCwwLDEtLjIxLDIuMDloLTEwLjlhNC41Niw0LjU2LDAsMCwwLDMuMDgsNC4xNiw1LjgyLDUuODIsMCwwLDAsMS44MS4yNyw3LjcyLDcuNzIsMCwwLDAsNC0xLjIzbDEuNTYsMi44M0ExMC41MSwxMC41MSwwLDAsMSwyNTIuMzYsMzE5LjU5Wm0tNC4zNC0xMWg3LjJxMC0zLjQyLTIuNjUtMy44NWE0LDQsMCwwLDAtLjctLjA2LDMuNTQsMy41NCwwLDAsMC0zLjI0LDEuOTRBNS43Niw1Ljc2LDAsMCwwLDI0OCwzMDguNTdaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtODUuODcgLTUwLjgxKSIvPg0KICAgICAgPHBhdGggZD0iTTI3MC42NCwzMTkuNTlhOC4yNiw4LjI2LDAsMCwxLTYuNjEtMi44Niw5LjQ1LDkuNDUsMCwwLDEtMi4xNi02LjM3LDkuMzYsOS4zNiwwLDAsMSwzLTcuMjQsNy42OSw3LjY5LDAsMCwxLDUuMjYtMi4wNiw2LjU4LDYuNTgsMCwwLDEsNi4zMSwzLjYsMTAuMzgsMTAuMzgsMCwwLDEsMS4wOCw0Ljg3LDcuMzYsNy4zNiwwLDAsMS0uMjIsMi4wOUgyNjYuMzdhNC41Niw0LjU2LDAsMCwwLDMuMDcsNC4xNiw1Ljg5LDUuODksMCwwLDAsMS44Mi4yNyw3LjY2LDcuNjYsMCwwLDAsNC0xLjIzbDEuNTcsMi44M0ExMC41NCwxMC41NCwwLDAsMSwyNzAuNjQsMzE5LjU5Wm0tNC4zNC0xMWg3LjIxcTAtMy40Mi0yLjY1LTMuODVhNC4wOCw0LjA4LDAsMCwwLS43MS0uMDYsMy41MywzLjUzLDAsMCwwLTMuMjMsMS45NEE2LDYsMCwwLDAsMjY2LjMsMzA4LjU3WiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTg1Ljg3IC01MC44MSkiLz4NCiAgICA8L2c+DQogICAgPGc+DQogICAgICA8cGF0aCBkPSJNMjUxLjgzLDM0Ny4xOWwtMS42My02aC03LjU3bC0xLjYzLDZoLTQuNzRsNy40OC0yMy4zM2g1LjQ4bDcuNDgsMjMuMzNabS04LjE5LTkuNmg1LjU0bC0uNy0yLjU2Yy0uMDYtLjItLjYzLTIuMzMtMS43LTYuMzdxLS4xOC0uNzEtLjMzLTEuMjZoLS4xM3EtLjgyLDMuNTctMiw3LjYzWiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTg1Ljg3IC01MC44MSkiLz4NCiAgICAgIDxwYXRoIGQ9Ik0yNTkuMDcsMzQ3LjE5VjMyOS41NWgzLjc4bC4zMSwyLjMxaC4xMmE4LjU3LDguNTcsMCwwLDEsNS43My0yLjc3cTUuNDQuMDYsNS40OCw3LjExdjExaC00LjY1VjMzNi43NmMwLTItLjUxLTMuMjItMS41NC0zLjU3YTMuMTYsMy4xNiwwLDAsMC0uOTUtLjEzLDQuNjEsNC42MSwwLDAsMC0zLDEuMzlsLS42OC42MXYxMi4xM1oiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC04NS44NyAtNTAuODEpIi8+DQogICAgICA8cGF0aCBkPSJNMjg1LjczLDM0Ny42MnEtNS43OS0uMDYtNS44Mi02LjYxdi03LjgyaC0yLjQ2di0zLjQybDIuNzEtLjIyLjUyLTQuNzRoMy44OHY0Ljc0aDQuMzR2My42NGgtNC4zNFYzNDFjMCwyLC44NCwzLDIuNCwzYTQuNTksNC41OSwwLDAsMCwxLjcyLS40bC43NywzLjM5QTEyLjMyLDEyLjMyLDAsMCwxLDI4NS43MywzNDcuNjJaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtODUuODcgLTUwLjgxKSIvPg0KICAgIDwvZz4NCiAgPC9nPg0KPC9zdmc+DQo=",
          "type": "image/svg+xml",
          "sizes": "192x192"
        }
      ],
      "display": "standalone",
      "start_url": "/",
      "theme_color": "rgb(51, 51, 51)",
      "background_color": "rgb(51, 51, 51)"
    }
  </script>
</html>
