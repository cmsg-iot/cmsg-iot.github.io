<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>JavaScriptIoT - SmartGreenHouse</title><link rel="stylesheet" href="./style.css" type="text/css"></head><body><div class="style-card"></div><div id="system" class="elementToFadeInAndOut"><ul><li>裝置名稱<div title="點擊更新裝置名稱" id="device" onclick="let name = prompt('輸入裝置名稱: '); name === null ? null:editDeviceName(name);">----</div></li><li>WiFi<div><button title="點擊開啟wifi功能選單" id="wifi" class="btn-system" onclick="showWifi()">----</button></div></li><li>訊號強度<button title="點擊更新裝置wifi名稱與密碼" class="btn-system" type="button" onclick="editSSID()">SSID修改</button><div title="SAP mode 表示未連接任何外部網路，<-xx>則表示連上外部網路的訊號強度" id="RSSI">----</div></li><li>啟動時間<div title="裝置已開機時間(若reset則從1開始)" id="LT">----</div></li><li>UART bps<div title="點擊更新裝置 UART baud" id="bps" onclick="let v = prompt('輸入Baud: '); v === null ? null:editBaud(v);">----</div></li><div class="version">v1.5.1</div></ul></div><div class="chart-container"><div id="chart_TH" class="elementToFadeInAndOut"><div class="chart-bg"><div class="chart-title">空氣溫度<br>RAW<div id="air_T_raw">-</div></div><canvas title="點擊更新轉換程式" id="air_T" onclick="let v = prompt('輸入空氣溫度轉換程式: ',localStorage.getItem('formula_air_T')); v === null ? null:updateAirTempFormula(v);"></canvas><div id="air_T_value" class="T-value">-</div></div><div class="chart-bg"><div class="chart-title">空氣濕度<br>RAW<div id="air_H_raw">-</div></div><canvas title="點擊更新轉換程式" id="air_H" onclick="let v = prompt('輸入空氣濕度轉換程式: ',localStorage.getItem('formula_air_H')); v === null ? null:updateAirHumityFormula(v);"></canvas><div id="air_H_value" class="H-value">-</div></div></div><div id="chart_SM" class="elementToFadeInAndOut"><div class="chart-bg btn-primary"><div class="chart-title btn-primary">土壤濕度<div><table><thead><th>RAW</th><th>潮濕</th><th>乾燥</th></thead><tbody><td id="soil_H_raw">-</td><td id="soil_H_wet" onclick="let v = prompt('輸入水中感測數值: '); v === null ? null:setSoilWet(v);">-</td><td id="soil_H_dry" onclick="let v = prompt('輸入空氣中感測數值: '); v === null ? null:setSoilDry(v);">-</td></tbody></table></div></div><canvas title="點擊更新轉換程式" id="soil_H" onclick="let v = prompt('輸入土壤濕度轉換程式: ',localStorage.getItem('formula_soil_H')); v === null ? null:updateSoilHumityFormula(v);"></canvas><div id="soil_H_value" class="H-value">-</div></div><div class="chart-bg btn-primary"><div class="fan-block"><button style="font-size: 16px;" onclick="fanStart(1)">快</button> <button style="font-size: 16px;" onclick="fanStart(2)">中</button> <button style="font-size: 16px;" onclick="fanStart(3)">慢</button> <button style="font-size: 16px;" onclick="fanStart(0)">停</button> RAW:<div id="fan_raw">-</div></div><div id="fan" class="ceiling-container"><div class="ceiling-fan horizontal left"></div><div class="ceiling-fan horizontal right"></div><div class="ceiling-fan vertical rotated top"></div><div class="ceiling-fan vertical rotated bottom"></div></div></div></div></div><div id="loop"><div class="code-block"><div id="loop-edit" class="zoom-block"><h2>程式編輯區</h2><div class="other-block"><div class="btn-import"><label for="upload">匯入 <input type="file" id="upload" accept=".json" onchange="ImportConfig()"></label></div><div><a id="export" onclick="ExportConfig()"><button class="btn-system">匯出</button></a></div><button class="btn-system" onclick="swTerminal()">終端</button></div><div><button title="點擊切換編輯模式" id="loop-code" style="font-size: 16px;" onclick="swCodeStyle()">方塊程式</button> <button title="開啟/關閉 方塊物件欄" id="loop-swBlock" style="font-size: 16px; display: none;" onclick="swBlocks()">顯示方塊</button> <button title="開啟/關閉 方塊轉換js預覽視窗" id="loop-codeView" style="font-size: 16px; display: none;" onclick="swCodeView()">方塊js預覽</button> <button title="點擊縮放程式區塊" id="loop-zoom" style="font-size: 16px;" onclick="Zoom()">展開</button></div><div class="select-block"><select id="loop-selectCode" class="select" style="background-color: #cdffee;" onchange="if(this.options.selectedIndex) {loop_select_code(this.options.selectedIndex);}"></select> <select id="block-selectCode" class="select" style="background-color: #cdffee; display: none;" onchange="if(this.options.selectedIndex) {block_select_code(this.options.selectedIndex);}"></select> <select title="在編輯區塊中加入常用JS程式碼" id="loop-addCode" class="select" onchange="if(this.options.selectedIndex) {loop_select_add(this.options.selectedIndex);this.selectedIndex=0}"><option selected="true" disabled="新增JS程式碼" label="新增JS程式碼"></option><option label="新增delay"></option><option label="新增console.log"></option><option label="新增if判斷"></option><option label="新增迴圈"></option></select></div><div class="cmd-block noselect"><button title="執行區塊中程式，未設定delay下，每100ms執行一次程式" class="btn-exec" onclick="newLoop()">執行</button> <button title="停止程式執行" class="btn-danger" onclick="StopLoop()">停止</button> <button title="清除輸出訊息" class="btn-warning" onclick="clearLog(1)">清除訊息</button> <button title="清除程式區塊與輸出訊息" class="btn-danger" onclick="clearAll(1)">清除全部</button></div><div id="loop-block-area" class="elementToFadeInAndOut"><div id="drag-drop-containers"><div id="target-containers"></div></div></div><textarea id="loop-codeView-result" cols="50" rows="5" disabled="disabled" class="elementToFadeInAndOut" style="display: none;"></textarea> <textarea id="loop-tx" cols="50" rows="10" class="elementToFadeInAndOut"></textarea> <textarea id="loop-result" cols="50" rows="5" disabled="disabled" class="elementToFadeInAndOut"></textarea></div></div></div><div title="匯入.json程式記錄檔" id="open-upload" class="side-bar elementToFadeInAndOut"><label for="upload" class="btn-open">匯入 <input type="file" id="upload" accept=".json" onchange="ImportConfig()"></label></div><div title="匯出.json程式記錄檔" id="open-export" class="side-bar elementToFadeInAndOut"><a id="export" onclick="ExportConfig()"><button class="btn-open">匯出</button></a></div><div title="開啟/關閉 空氣資訊" id="open-chart-TH" class="side-bar elementToFadeInAndOut"><button class="btn-open" onclick="swChartView_TH()"><a href="#chart_TH">空氣</a></button></div><div title="開啟/關閉 土壤與風扇資訊" id="open-chart-SM" class="side-bar elementToFadeInAndOut"><button class="btn-open" onclick="swChartView_SM()"><a href="#chart_SM">土壤</a></button></div><div title="開啟/關閉 系統資訊" id="open-sys" class="side-bar elementToFadeInAndOut"><button class="btn-open" onclick="swSystem()">系統</button></div><div title="開啟/關閉 終端功能" id="open-term" class="side-bar elementToFadeInAndOut"><button class="btn-open" onclick="swTerminal()">終端</button></div><div title="開啟/關閉 選單功能" id="side-menu" class="side-bar elementToFadeInAndOut"><button class="btn-open" onclick="swMenuBar()">選單</button></div><div id="terminal" class="elementToFadeInAndOut"><button class="btn-close" onclick="swTerminal()">X</button><h2>終端畫面 <button class="btn-system" style="display: none;" onclick="openHelp()">?</button></h2><textarea id="tx" cols="50" rows="10" disabled="disabled"></textarea><div><!-- <input list="cmd-list" id="ice-cream-choice" name="ice-cream-choice" /> --> 命令<input list="cmd-list" type="text" id="WSSCMD" autocomplete="off"><button class="btn-system" onclick='execCmd("WSSCMD")'>傳送</button> <button class="btn-system" onclick="clearMsg()">清除</button><!-- <datalist id="cmd-list" style="height: 34px;width: 153px;">
                <option value="send CMD:">
                <option value="send REQ:">
                <option value="get recv Addr">
                <option value="Fan On">
                <option value="Fan Off">
                <option value="send CMD:">
                <option value="send REQ:">
                <option value="get recv Addr">
                <option value="Fan On">
                <option value="Fan Off">
                <option value="send CMD:">
                <option value="send REQ:">
                <option value="get recv Addr">
                <option value="Fan On">
                <option value="Fan Off">
            </datalist> --></div></div><!-- Drag & Drop Block Program --><div id="index-source-container" class="elementToFadeInAndOut"><table><tr><td title="取得裝置所回傳的資料，等同於變數" id="index-data" draggable="true" class="data-index">資料</td><td title="點擊可後可輸入任意變數、數值與運算" id="index-val" draggable="true" class="val-index">值</td><td title="點擊可定義變數名稱" id="index-var" draggable="true" class="var-index">變數</td><td title="布林函式" id="index-op" draggable="true" class="op-index">邏輯</td><td title="比較兩數結果" id="index-bool" draggable="true" class="bool-index">判斷</td></tr><tr><td title="依據判斷結果執行程式" id="index-if" draggable="true" class="if-index">如果</td><td title="將值設定給變數，點擊後可設定為全域或區域變數，預設為全域" id="index-setV" draggable="true" class="setV-index">設定</td><td title="控制輸入、發送命令等功能" id="index-control" draggable="true" class="control-index">控制</td><td title="輸出訊息於下方欄位" id="index-log" draggable="true" class="log-index">顯示</td><td title="執行下一行程式碼所等待時間" id="index-delay" draggable="true" class="delay-index">等待</td></tr></table></div><div id="trash-container" data-role="drag-drop-container" class="trash trash-left elementToFadeInAndOut">垃圾桶</div><div id="trash-container2" data-role="drag-drop-container" class="trash trash-right elementToFadeInAndOut">垃圾桶</div><div id="drag-drop-source"><div id="source-container" data-role="drag-drop-container" class="container" style="display: none;"><div id="drag-source-if" draggable="true" class="if-block basic-style"><div class="if-blcok block-style">如果<div data-role="drag-drop-container" class="bool-block-area" data-index="1">判斷</div></div></div><div id="drag-source-data" draggable="true" class="data-block basic-style"><select data-type="select" select-index="0" onclick="this.setAttribute('select-index',this.selectedIndex); storeBlock();"></select></div><div id="drag-source-val" draggable="true" class="val-block basic-style"><div class="val-block block-style" onclick="let t =prompt('輸入值 (^˵◕ω◕˵^) :',this.innerText); t.length < 1
                ? alert('格式錯誤，長度至少爲1，不可爲空白 ( ꒪Д꒪)ノ')
                : (this.innerText = t); storeBlock();">值</div></div><div id="drag-source-var" draggable="true" class="var-block basic-style"><div class="var-block block-style" onclick="let t =prompt('輸入變數名稱 (^˵◕ω◕˵^) :',this.innerText); t.length < 1 || t.match(/\s|\W|^[0-9]/)? alert('格式錯誤，長度至少爲1，不可爲空白 ( ꒪Д꒪)ノ'):this.innerHTML = t; storeBlock();">變數</div></div><div id="drag-source-op" draggable="true" class="op-block basic-style"><select data-type="select" select-index="0" onclick="this.setAttribute('select-index',this.selectedIndex); storeBlock();"><option value="<" label="<"></option><option value=">" label=">"></option><option value="==" label="="></option><option value="!=" label="≠"></option><option value="<=" label="≤"></option><option value=">=" label="≥"></option><option value="&&" label="且"></option><option value="||" label="或"></option></select></div><div id="drag-source-log" draggable="true" class="log-block basic-style"><div class="log-block block-style">顯示<div data-role="drag-drop-container" class="v-block-area">變數|值</div></div></div><div id="drag-source-control" draggable="true" class="control-block basic-style"><div class="control-block block-style">控制 <select data-type="select" select-index="0" onclick="this.setAttribute('select-index',this.selectedIndex); storeBlock();"><option label="風扇" value="fan"></option><option label="電磁閥(開)" value="valveOn"></option><option label="電磁閥(關)" value="valveOff"></option><option label="遠端命令" value="remote_cmd"></option></select> 參數:<div data-role="drag-drop-container" class="v-block-area">變數|值</div></div></div><div id="drag-source-delay" draggable="true" class="delay-block basic-style"><div class="delay-block block-style">等待 <input type="number" min="300" max="100000" step="100" value="300" data-type="input" oninput="this.setAttribute('value',this.value); storeBlock();"> 毫秒</div></div><div id="drag-source-setV" draggable="true" class="setV-block basic-style"><div class="setV-block block-style" onclick="updateVar(this)">設定<div style="color: rgb(0, 255, 149);">全域</div><div data-role="drag-drop-container" class="var-block-area">變數</div>為<div data-role="drag-drop-container" class="v-block-area">變數|值</div></div></div><div id="drag-source-bool" draggable="true" class="bool-block basic-style"><div class="bool-block block-style"><div data-role="drag-drop-container" class="v-block-area">變數|值</div><div><select data-type="select" select-index="0" onclick="this.setAttribute('select-index',this.selectedIndex); storeBlock();"><option value="<" label="<"></option><option value=">" label=">"></option><option value="==" label="="></option><option value="!=" label="≠"></option><option value="<=" label="≤"></option><option value=">=" label="≥"></option><option value="&&" label="且"></option><option value="||" label="或"></option></select></div><div data-role="drag-drop-container" class="v-block-area">變數|值</div></div></div></div></div><div id="mask-wifi" class="mask" onclick="closeWifi()"></div><div id="mask-help" class="mask" onclick="closeHelp()"></div><!-- WIFI頁面 --><div id="wifi-content" class="float-content elementToFadeInAndOut"><h2>已連上 Wifi</h2><div id="wifi-now"></div><div id="wifi-list"><h2>搜尋中 Wifi</h2><div><button title="點擊搜尋可用wifi" id="wifi-refresh" class="w-scan" onclick="scanWifi()">搜尋</button> <button title="點擊重新連接最後一次連上的wifi" id="wifi-mode" class="w-scan">重新連接</button> <button title="點擊設定遠端裝置IP位址" id="wifi-remote" class="w-ip" onclick="let ip = prompt('輸入遠端裝置IP位址: '); ip === null ? null:editRemoteAddr(ip)">遠端IP 未設定</button> <button title="點擊更新已設定的遠端IP" class="w-ip-refresh" onclick="getRemoteAddr()">更新IP</button> <button title="點擊更新此裝置的區網IP" id="wifi-local" class="w-ip" onclick="getLocalIP()">區網IP 未更新</button></div><ul id="wifi-result"></ul></div></div><!-- help頁面 --><div id="help-content" class="float-content elementToFadeInAndOut"><table><thead><th>功能</th><th>指令</th></thead><tbody><tr><td>WiFi搜尋</td><td>@AP scan</td></tr><tr><td>WiFi SSID設定</td><td>@set SAP [SSID]:[PWD]</td></tr><tr><td>連線外網WiFi</td><td>@AP connect [SSID]:[PWD]</td></tr><tr><td>清除外網連線</td><td>@AP connect reset</td></tr><tr><td>重新連上上次WiFi</td><td>@AP connect reconnect</td></tr><tr><td>設定遠端位址</td><td>set recv Addr IP:PORT</td></tr><tr><td>取得設定遠端位址</td><td>get recv Addr</td></tr><tr><td>發送命令至遠端</td><td>send CMD:xxx</td></tr><tr><td>設定Local IP</td><td>@set Local IP: IP</td></tr><tr><td>伺服馬達控制</td><td>set RCx y</td></tr><tr><td>PWM 輸出控制</td><td>set Px y</td></tr></tbody></table></div></body><script>var js = ["gauge/gauge.js", "app.js", "block.js"];
    document.addEventListener("DOMContentLoaded", function (event) {
        setTimeout(addScript, 1000);
        setTimeout(addScript, 2000);
        setTimeout(addScript, 3000);
    });

    function addScript() {
        script = document.createElement("script");
        script.type = "text/javascript";
        script.async = true;
        // script.onload = function () {
        //     console.log("Added Script");
        // };
        script.src = `./${js.shift()}`;
        document.getElementsByTagName("head")[0].appendChild(script);
    }</script></html>