function $(e){return document.getElementById(e)}var w,res_wifi=void 0,swSys=!0,swTerm=!1,swChartTH=!1,swChartSM=!1,swMenu=!1,swZoom=!1,swCode=!1,swBlock=!1,swCV=!1,loop_selectIndex=0,loop_code_arr=[],block_selectIndex=0,block_code_arr=[],DATA,request_queue=[],connectedDevices=[],scanHandler;function $(e){return document.getElementById(e)}function swCodeStyle(){swCode?($("loop-code").innerHTML="方塊程式",$("loop-block-area").style.display="none",$("loop-tx").style.display="block",$("loop-swBlock").style.display="none",$("loop-swBlock").style.backgroundColor="hotpink",$("loop-codeView").style.display="none",$("loop-swBlock").innerHTML="顯示方塊",$("loop-codeView").innerHTML="預覽關閉",$("index-source-container").style.display="none",$("loop-codeView-result").style.display="none",$("block-selectCode").style.display="none",$("loop-selectCode").style.display=""):($("loop-code").innerText="JS 程式",$("loop-block-area").style.display="block",$("loop-tx").style.display="none",$("loop-swBlock").style.display="initial",$("loop-codeView").style.display="initial",$("loop-swBlock").innerHTML="隱藏方塊",$("loop-codeView").innerHTML="方塊JS預覽",$("loop-codeView").style.backgroundColor="#cdffee",$("index-source-container").style.display="block",$("block-selectCode").style.display="initial",$("loop-selectCode").style.display="none",swCV=!(swBlock=!0)),swCode=!swCode}function swBlocks(){swBlock?($("loop-swBlock").innerHTML="顯示方塊",$("loop-swBlock").style.backgroundColor="#cdffee",$("index-source-container").style.display="none"):($("loop-swBlock").innerHTML="隱藏方塊",$("loop-swBlock").style.backgroundColor="hotpink",$("index-source-container").style.display="block"),swBlock=!swBlock}function swCodeView(){swCV?($("loop-codeView").innerHTML="方塊js預覽",$("loop-codeView").style.backgroundColor="#cdffee",$("loop-block-area").style.display="block",$("loop-codeView-result").style.display="none"):($("loop-codeView").innerHTML="預覽關閉",$("loop-codeView").style.backgroundColor="hotpink",$("loop-block-area").style.display="none",$("loop-codeView-result").style.display="initial",$("loop-codeView-result").value=AllBlock2js()),swCV=!swCV}function Zoom(){swZoom?($("loop-edit").classList.remove("zoom-in"),$("loop-zoom").innerHTML="展開",$("loop-zoom").style.backgroundColor="#cdffee",$("loop-result").style=""):($("loop-edit").classList.add("zoom-in"),$("loop-zoom").innerHTML="返回",$("loop-zoom").style.backgroundColor="hotpink",$("loop-result").style.display="none"),swZoom=!swZoom}function swSystem(){swSys?$("system").style.display="none":($("system").style.display="block",scroll({top:0,left:0,behavior:"smooth"})),swSys=!swSys}function swTerminal(){swTerm?($("terminal").style.display="none",$("loop").style.marginBottom="0px"):($("terminal").style.display="block",$("loop").style.marginBottom="450px"),swTerm=!swTerm}function swChartView_TH(){swChartTH?$("chart_1").style="display: none !important":$("chart_1").style.display="block",swChartTH=!swChartTH}function swChartView_SM(){swChartSM?$("chart_2").style="display: none !important":$("chart_2").style.display="block",swChartSM=!swChartSM}function swMenuBar(){swMenu?($("open-term").style.display="none",$("open-sys").style.display="none",$("open-chart-1").style.display="none",$("open-chart-2").style.display="none",$("open-export").style.display="none",$("open-upload").style.display="none",$("side-menu").children[0].innerHTML="選單"):($("open-term").style.display="block",$("open-sys").style.display="block",$("open-chart-1").style.display="block",$("open-chart-2").style.display="block",$("open-export").style.display="block",$("open-upload").style.display="block",$("side-menu").children[0].innerHTML="收起"),swMenu=!swMenu}function updateChart(e){$("pump_P_raw").innerText=e.pump_P_raw,$("pump_P_value").innerText=pump_P_output+" kg/cm²",gauge_pump_P.set(pump_P_output)}function setSoilWet(e){postCmd(`set Soil Moisture H:${e}`)}function setSoilDry(e){postCmd(`set Soil Moisture L:${e}`)}function clearMsg(){$("tx").value=""}function showWifi(){$("mask-wifi").style="display: block;",$("wifi-content").style="display: block",document.body.style.overflow="hidden",scanWifi()}function scanWifi(){var o=0,l="",n=$("wifi-result"),i=$("wifi-refresh");res_wifi="",n.innerHTML="",postCmd("@AP scan"),i.disabled=!0;var e=document.createElement("div"),t=document.createElement("h3");t.innerHTML="搜尋中...",e.appendChild(t),n.appendChild(e),scanHandler=setInterval(()=>{return 10<=(o+=1)?(alert("已逾時，請重新搜尋。"),clearInterval(scanHandler),n.innerHTML="",void(i.disabled=!1)):void(res_wifi&&(l=res_wifi,$("wifi-now").innerHTML=$("wifi").innerText,n.innerHTML="",e=l.split("|"),t=document.createElement("li"),n.appendChild(t),e.forEach(e=>{var o;""!==e&&((o=document.createElement("input")).className="w-btn",o.type="button",o.value=e,o.onclick=()=>inputWifiPWD(e),t.appendChild(o))}),clearInterval(scanHandler),i.disabled=!1));var e,t},1e3)}function closeWifi(){$("wifi-content").style="display: none",$("mask-wifi").style="display: none",$("wifi-list").style="display: block",document.body.style.overflow="",clearInterval(scanHandler)}function inputWifiPWD(e){var o=prompt(`SSID: ${e},Wifi密碼: `);null!==o&&(postCmd(`@AP connect [${e}]:[${o}]`),$("wifi-content").style="display: none",$("mask-wifi").style="display: none",$("wifi-list").style="display: block")}function resetWifi(){postCmd("@AP connect reset")}function reconnectWifi(){postCmd("@AP connect reconnect")}function switchWifi(e){"standalone"===e?($("wifi").innerText="獨立模式",$("wifi-now").innerText="獨立模式",$("wifi-mode").onclick=reconnectWifi,$("wifi-mode").innerText="重新連接",$("wifi-mode").title="重新連接最後一次連上的wifi"):($("wifi").innerText=e,$("wifi-now").innerText=e,$("wifi-mode").onclick=resetWifi,$("wifi-mode").innerText="切斷連接",$("wifi-mode").title="切斷wifi連接，切換為獨立模式")}function openHelp(){$("mask-help").style.display="block",$("help-content").style.display="block"}function closeHelp(){$("mask-help").style.display="none",$("help-content").style.display="none"}function editDeviceName(e){postCmd(`@set Device ID: ${e}`)}function editBaud(e){postCmd(`@bps: ${e}`)}function editRemoteAddr(e){void 0!==e.split(":")[1]&&""!==e.split(":")[1]?postCmd(`set recv Addr ${e}`):postCmd(`set recv Addr ${e.split(":")[0]}:80`)}function getRemoteAddr(){postCmd("get recv Addr")}function getLocalIP(){postCmd(`send +ip REQ:ID:${$("device").innerText}`)}function updatePumpFormula(e){localStorage.setItem("formula_pump_P",e)}function setPumpSV(e){pump_P_sv=e,$("pump_P_sv").innerText=e}function handleRemoteRequest(e){var o=confirm("是否接受請求?(取消則清除)"),t=e.id.split("-")[1];o&&(clearAllTimeouts(),e.innerText.includes("ID")?postCmd(e.innerText.split("#")[1]):postCmd(e.innerText)),request_queue.splice(t,1),showRemoteRequest()}function clearRemoteRequest(){request_queue=[],showRemoteRequest()}function swValve(e){var o=e.id.split("_")[1];e.checked?(e.checked=!1,postCmd(`Station ${o} On`)):(e.checked=!0,postCmd(`Station ${o} Off`))}window.pump_P_sv=0,window.pump_P_output=0,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),swChartView_TH(),swChartView_SM(),console.oldLog=console.log,console.log=function(e){return console.oldLog(e),$("loop-result").value+=`${e}\r\n`,$("loop-result").scrollTop=$("loop-result").scrollHeight,e},$("WSSCMD").addEventListener("keyup",e=>{"Enter"===e.key&&(e.preventDefault(),execCmd("WSSCMD"))});var config_pump_P={angle:0,lineWidth:.3,radiusScale:1,pointer:{length:.5,strokeWidth:.033,color:"#666666"},limitMax:!0,limitMin:!0,generateGradient:!0,highDpiSupport:!0,staticLabels:{font:"10px sans-serif",labels:[0,1,2,3,4,5,6,7,8,9,10],color:"#000000",fractionDigits:0},staticZones:[{strokeStyle:"#30B32D",min:0,max:2},{strokeStyle:"#30B32D",min:2,max:4},{strokeStyle:"#30B32D",min:4,max:6},{strokeStyle:"#FFDD00",min:6,max:8},{strokeStyle:"#F03E3E",min:8,max:10}],renderTicks:{divisions:10,divWidth:1.1,divLength:.6,divColor:"#333333",subDivisions:2,subLength:.4,subWidth:.6,subColor:"#666666"}},gauge_pump_P=new Gauge($("pump_P")).setOptions(config_pump_P);function connect(){"undefined"!=typeof Worker?(void 0===w&&((w=new Worker("./worker.js")).onmessage=wkMsg),cmd={URL:document.URL},w.postMessage(cmd)):console.log("not support Worker")}function wkMsg(o){try{if(o.data instanceof Uint8Array)return void(0===o.data[0]?showSYS(o.data):1===o.data[0]?showEEPROM(o.data):2===o.data[0]&&showUserData(o.data));var e;for(i in o.data)if(e=$(i),"tx"==i&&e){if(e=$("tx"),str=e.value,str+="\n",str+=o.data[i],["ESP:set","ESP:SET"].some(e=>o.data[i].includes(e))&&alert("更換SSID成功，reset後生效"),"reconnected"===o.data[i]&&alert("已重新連上wifi!"),"reset"===o.data[i]&&alert("已切換至獨立模式!"),o.data[i].includes("set Device ID:")&&alert("已修改裝置名稱!"),o.data[i].includes("set Serial baudrate")&&alert("已修改裝置 UART Baud!"),o.data[i].includes("set correct baudrate")&&alert("請設定支援的Baud: 9600,19200,38400,74800,115200,230400"),o.data[i].includes("save")?(alert(`已設定遠端IP: ${o.data[i].split(" ")[1]}`),getRemoteAddr()):o.data[i].includes(":80")&&($("wifi-remote").innerText=`遠端IP ${o.data[i]}`),o.data[i].includes("file not exist")&&($("wifi-remote").innerText="遠端IP 未設定"),o.data[i].includes("IP:")&&($("wifi-local").innerText=`區網IP ${o.data[i].split(":")[1]}`),o.data[i].includes("Get request: REQ:")){let e=o.data[i];(e.includes("ID:")?addConnectedDevices:addRemoteRequest)(e)}1e5<str.length&&(str=""),str.includes("|")&&(res_wifi=o.data.tx),e.value=str,e.scrollTop=e.scrollHeight}else"content"===i?"no receive ip and port!!"===o.data[i]?alert("未設定遠端IP!"):"connect fail"===o.data[i]&&alert("與目標裝置連接失敗，請確認目標裝置的IP位址是否與遠端IP一致!"):e&&("wifi"===i?switchWifi(o.data[i]):e.innerHTML=o.data[i])}catch(e){console.error(e)}}function postCmd(e){""!==e&&(jsonCmd={SENDCMD:e},w.postMessage(jsonCmd))}function execCmd(e){editCmd=0,str=$(e).value,$(e).value="",0===str.indexOf("clear msg")?$("tx").value="":postCmd(str)}function editSSID(){var e,o=prompt("請輸入SSID:");/^.{1,16}$/.test(o)?(e=prompt("請輸入8~16位密碼:"),/[0-9a-zA-Z]{8,16}$/.test(e)?confirm(`確定更改為 wifi名稱: ${o}, 密碼: ${e} ?`)&&postCmd(`@set SAP [${o}]:[${e}]`):alert("格式不符，請重試")):alert("格式不符，長度為1~16")}function showSYS(t){var e=t[1];if(e<<=8,!((e+=t[2])<4)){let o=0;for(let e=3;e<7;++e)o<<=8,o+=t[e];$("LT").innerHTML=o}}function showEEPROM(o){var t="\t";for(let e=0;e<16;++e)t+=e<16?"x":"",t+=e.toString(16),t+="\t";t+="\n";let l=3;for(let e=0;e<20;++e){t+=e<16?"0":"",t+=e.toString(16),t+="x",t+="\t";for(let e=0;e<16;++e){var n=o[l++];t+=n<16?"0":"",t+=n.toString(16),t+="\t"}t+="\n"}$("tx").value=t}function showUserData(e){updateChart(DATA=data2json(e)),showValveStatus(DATA),showRemoteRequest(),showConnectedDevices(),updataSensors()}function addRemoteRequest(e){let o=e;void 0!==o&&(o=o.includes("HTTP")?o.substring(o.indexOf("REQ:")+4,o.indexOf("HTTP")-1):o.substring(o.indexOf("REQ:")+4),void 0!==o&&request_queue.unshift(o),30<request_queue.length&&(request_queue.length=30))}function showRemoteRequest(){let n=$("request-result");n.innerHTML="",request_queue!==[]&&(request_queue.forEach((e,o)=>{var t,l;""!==e&&(t=document.createElement("button"),l=document.createElement("li"),t.id=`request-${o}`,t.className="request-btn",t.innerHTML=e,t.title=e,t.onclick=()=>handleRemoteRequest(t),l.appendChild(t),n.appendChild(l))}),$("request-count").innerText=`數量: ${request_queue.length}`)}function addConnectedDevices(e){let o=e;void 0!==o&&(o=(o.includes("HTTP")?o.substring(o.indexOf("ID:")+3,o.indexOf("HTTP")-1):o.substring(o.indexOf("ID:")+3)).split(" from "),0<connectedDevices.filter(e=>e[0]===o[0]&&e[1]===o[1]).length||(0<connectedDevices.filter(e=>e[0]===o[0]&&e[1]!==o[1]).length?connectedDevices.filter(e=>e[0]===o[0]&&e[1]!==o[1])[0][1]=o[1]:0<connectedDevices.filter(e=>e[0]!==o[0]&&e[1]===o[1]).length?connectedDevices.filter(e=>e[0]!==o[0]&&e[1]===o[1])[0][0]=o[0]:connectedDevices.unshift(o),30<connectedDevices.length&&(connectedDevices.length=30)))}function showConnectedDevices(){let n=$("connected-result");n.innerHTML="",connectedDevices!==[]&&(connectedDevices.forEach((e,o)=>{var t,l;""!==e&&(t=document.createElement("button"),l=document.createElement("li"),t.id=`connected-${o}`,t.className="request-btn",t.innerHTML=`${e[0]}<br/>${e[1]}`,t.title="開啟裝置網頁",t.onclick=()=>window.open(`http://${e[1]}`,"_blank"),l.appendChild(t),n.appendChild(l))}),$("connected-count").innerText=`數量: ${connectedDevices.length}`)}function showValveStatus(o){for(let e=0;e<12;e++)0<o.valve_raw[e]?($(`valve_${e+1}`).innerText="ON",$(`valve_${e+1}_sw`).checked=!0):($(`valve_${e+1}`).innerText="OFF",$(`valve_${e+1}_sw`).checked=!1,$(`valve_${e+1}_color`).style=""),$(`valve_${e+1}_sw`).checked&&(2048<o.valve_raw[12]?$(`valve_${e+1}_color`).style.backgroundColor="orange":0<o.valve_raw[12]&&($(`valve_${e+1}_color`).style.backgroundColor="#2196f3"))}function updataSensors(){eval(`window.pump_P_output = ${localStorage.getItem("formula_pump_P")}`)}function data2json(o){let t={valve_raw:[]};n=o[3],n<<=8,n+=o[4],t.pump_P_raw=n;for(let e=0;e<16;e++){var l=2*e,n=o[7+l];n<<=8,n+=o[8+l],t.valve_raw[e]=n}return t}function createClearAllTimeouts(){const o=()=>{};let t=setTimeout(o,0);return()=>{for(var e=setTimeout(o,0);t!==e;)t+=1,clearTimeout(t)}}function createClearAllIntervals(){const o=()=>{};let t=setInterval(o,0);return()=>{for(var e=setInterval(o,0);t!==e;)t+=1,clearInterval(t)}}gauge_pump_P.maxValue=10,gauge_pump_P.setMinValue(0),gauge_pump_P.animationSpeed=32,gauge_pump_P.set(0);const clearAllTimeouts=createClearAllTimeouts(),ClearAllIntervals=createClearAllIntervals();window.is_loop_enable=!1;var loop_count=1;const newLoop=async()=>{const delay=o=>new Promise(function(e){setTimeout(e,o)});if(swCode&&count_elements<1)alert("程式區塊不可為空值");else if(swCode||$("loop-tx").value){if(1===loop_count){let arr="";arr=(swCode?AllBlock2js():$("loop-tx").value).split("\n");let result=[];for(let i=0;i<arr.length;i++){const str=arr[i];-1!=str.indexOf("window")&&result.push(arr[i])}eval(result.join("")),$("loop-result").value=""}let time=300;if(!is_loop_enable)try{let arr_eval="";is_loop_enable=!0,clearAllTimeouts(),console.log(`\r\n<-----迴圈執行---第${loop_count}次----->\r\n`),$("loop-result").style.backgroundColor="#56ff2ca4",arr_eval=(swCode?AllBlock2js():$("loop-tx").value).split("\n");for(let i=0;i<arr_eval.length;i++){const str=arr_eval[i];-1!=str.indexOf("delay(")&&(arr_eval[i]=`await ${arr_eval[i]}`)}for(;-1!=arr_eval.join().indexOf("window");)for(let i=0;i<arr_eval.length;i++){const str=arr_eval[i];-1!=str.indexOf("window")&&arr_eval.splice(i,1)}await eval("(async () => {"+arr_eval.join("")+"\nis_loop_enable=false;})()"),loop_count+=1}catch(error){return clearAllTimeouts(),is_loop_enable=!1,$("loop-result").style.backgroundColor="#ff1f1fa4",console.log(error),void init_drag()}await delay(time),newLoop()}else alert("程式區塊不可為空值")};function StopLoop(){$("loop-result").value+="停止迴圈\r\n",is_loop_enable=!1,loop_count=1,clearAllTimeouts(),init_drag()}function clearLog(){$("loop-result").value="",$("loop-result").style=""}function clearAll(){confirm("是否清除區塊內所有程式(會覆蓋這個存檔) ?")&&(StopLoop(),$("loop-result").value="",$("loop-result").style="",swCode?readBlock("init_block"):$("loop-tx").value="")}function addDelay(){$("loop-tx").value+="\r\ndelay(1000);",$("loop-tx").scrollTop=$("loop-tx").scrollHeight}function addLog(){$("loop-tx").value+='\r\nconsole.log("顯示輸入資料結果");',$("loop-tx").scrollTop=$("loop-tx").scrollHeight}function addForloop(){$("loop-tx").value+=`\r\nvar array=[1,2,3,4,5];\r\nfor (let i = 0; i < array.length; i++) {
    let element = array[i];
    console.log(element);
  }`,$("loop-tx").scrollTop=$("loop-tx").scrollHeight}function addIfElse(){$("loop-tx").value+=`\r\nif () {
      
  } else if() {
      
  } else {
      
  }`,$("loop-tx").scrollTop=$("loop-tx").scrollHeight}function loop_select_add(e){switch(e){case 1:addDelay(1);break;case 2:addLog(1);break;case 3:addIfElse(1);break;case 4:addForloop(1)}localStorage.getItem("loop_code_name")&&localStorage.setItem(`loop_code_save_${localStorage.getItem("loop_code_name")}`,$("loop-tx").value)}function block_refact_localstorage(){var o=[];for(const e in localStorage)Object.hasOwnProperty.call(localStorage,e)&&e.includes("block_code_save")&&o.push(e);o=o.sort();for(let e=0;e<o.length;e++){var t=localStorage.getItem(o[e]);localStorage.removeItem(o[e]);var l=e+1<10?`0${e+1}`:`${e+1}`;o[e]=`${o[e].substring(0,16)}${l}:${o[e].substring(19)}`,localStorage.setItem(o[e],t)}init_block_code()}function block_select_code(e){var o=$("block-selectCode").options;if(e!==o.length-2)if(e!==o.length-1){o=o[e].text;if(localStorage.setItem("block_code_name",o),block_selectIndex=e,""===localStorage.getItem(`block_code_save_${o}`))return readBlock("init_block"),void($("loop-codeView-result").value=AllBlock2js());readBlock(`block_code_save_${o}`),$("loop-codeView-result").value=AllBlock2js()}else block_remove_code();else block_new_code()}function block_new_code(){var e=$("block-selectCode").options,o=e.length-2,t=prompt("請輸入名稱:","未命名");t?(readBlock("init_block"),t=o<10?`0${o}:${t}`:`${o}:${t}`,e.add(new Option(t,t),e[e.length-2]),localStorage.setItem(`block_code_save_${t}`,""),$("block-selectCode").selectedIndex=e.length-3,localStorage.setItem("block_code_name",t)):$("block-selectCode").selectedIndex=block_selectIndex}function block_remove_code(){var e=localStorage.getItem("block_code_name");if(!e)return alert("選擇存檔後才可刪除"),void($("block-selectCode").selectedIndex=0);confirm(`確定要刪除 ${e} ?`)?(localStorage.removeItem(`block_code_save_${e}`),block_refact_localstorage(),readBlock("init_block")):$("block-selectCode").selectedIndex=block_selectIndex}function init_block_code(){localStorage.setItem("block_code_name","");var e=$("block-selectCode"),o=e.options,t=document.createElement("option");e.innerHTML="",t.selected=!0,t.disabled="選擇方塊存檔",t.label="選擇方塊存檔",o.add(t),block_code_arr=[];for(const n in localStorage)Object.hasOwnProperty.call(localStorage,n)&&n.includes("block_code_save")&&block_code_arr.push(n.substring(16));block_code_arr=block_code_arr.sort();for(let e=0;e<block_code_arr.length;e++){var l=block_code_arr[e];o.add(new Option(l,l),o[o.length])}(t=document.createElement("option")).label="新增存檔",o.add(t),(t=document.createElement("option")).label="刪除存檔",o.add(t)}function loop_refact_localstorage(){var o=[];for(const e in localStorage)Object.hasOwnProperty.call(localStorage,e)&&e.includes("loop_code_save")&&o.push(e);o=o.sort();for(let e=0;e<o.length;e++){var t=localStorage.getItem(o[e]);localStorage.removeItem(o[e]);var l=e+1<10?`0${e+1}`:`${e+1}`;o[e]=`${o[e].substring(0,15)}${l}:${o[e].substring(18)}`,localStorage.setItem(o[e],t)}init_loop_code()}function loop_select_code(e){var o=$("loop-selectCode").options;e!==o.length-2?e!==o.length-1?(o=o[e].text,localStorage.setItem("loop_code_name",o),$("loop-tx").value=localStorage.getItem(`loop_code_save_${o}`),loop_selectIndex=e):loop_remove_code():loop_new_code()}function loop_new_code(){var e=$("loop-selectCode").options,o=e.length-2,t=prompt("請輸入名稱:","未命名");t?(t=o<10?`0${o}:${t}`:`${o}:${t}`,e.add(new Option(t,t),e[e.length-2]),localStorage.setItem(`loop_code_save_${t}`,""),$("loop-selectCode").selectedIndex=e.length-3,localStorage.setItem("loop_code_name",t),$("loop-tx").value=""):$("loop-selectCode").selectedIndex=loop_selectIndex}function loop_remove_code(){var e=localStorage.getItem("loop_code_name");if(!e)return alert("選擇存檔後才可刪除"),void($("loop-selectCode").selectedIndex=0);confirm(`確定要刪除 ${e} ?`)?(localStorage.removeItem(`loop_code_save_${e}`),loop_refact_localstorage(),$("loop-tx").value=""):$("loop-selectCode").selectedIndex=loop_selectIndex}function init_loop_code(){localStorage.setItem("loop_code_name","");var e=$("loop-selectCode"),o=e.options,t=document.createElement("option");e.innerHTML="",t.selected=!0,t.disabled="選擇JS存檔",t.label="選擇JS存檔",o.add(t),loop_code_arr=[];for(const n in localStorage)Object.hasOwnProperty.call(localStorage,n)&&n.includes("loop_code_save")&&loop_code_arr.push(n.substring(15));loop_code_arr=loop_code_arr.sort();for(let e=0;e<loop_code_arr.length;e++){var l=loop_code_arr[e];o.add(new Option(l,l),o[o.length])}(t=document.createElement("option")).label="新增存檔",o.add(t),(t=document.createElement("option")).label="刪除存檔",o.add(t)}function ExportConfig(){const e={};e.config={...localStorage};for(const n in e.config){var o;Object.hasOwnProperty.call(e.config,n)&&(o=e.config[n],e.config[n]=o)}var t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),l=URL.createObjectURL(t),t=prompt("檔案命名","未命名");t?($("export").href=l,$("export").download=`${Date.now()}_${t}.json`):($("export").removeAttribute("href"),$("export").removeAttribute("download"))}function ImportConfig(){localStorage.clear(),init_loop_code();var l,n,i=$("upload").files[0],a=new FileReader;a.readAsText(i,"UTF-8"),a.onload=function(e){n=e.target.result,$("tx").value=`import: ${i.name}\n`,$("tx").value+=n;for(const t in l=JSON.parse(a.result).config){var o;Object.hasOwnProperty.call(l,t)&&(o=l[t],localStorage.setItem(t,o))}},$("upload").value="",window.location.reload()}function clearMsg(){$("tx").value=""}function checkRemote(){"獨立模式"===$("wifi").innerText&&console.log("獨立模式無法進行遠端控制，請連上目標wifi!")}init_block_code(),$("loop-tx").addEventListener("input",e=>{e.preventDefault();e=localStorage.getItem("loop_code_name");e&&localStorage.setItem(`loop_code_save_${e}`,$("loop-tx").value)}),init_loop_code(),window.request_accept={set:o=>{if(null!==o){let e=$(`request-${o-1}`);e.innerText.includes("ID")?postCmd(e.innerText.split("#")[1]):postCmd(e.innerText),e.parentElement.remove(),request_queue.splice(o-1,1),showRemoteRequest()}}},window.request_cancel={set:o=>{if(null!==o){let e=$(`request-${o-1}`);e.parentElement.remove(),request_queue.splice(o-1,1),showRemoteRequest()}}},window.valveOn={set:e=>null===e?null:postCmd(`Station ${e} On`)},window.valveOff={set:e=>null===e?null:postCmd(`Station ${e} Off`)},window.remote_cmd={set:e=>{checkRemote(),null!==e&&postCmd(`send CMD:${e}`)}};